var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

import lex from 'pug-lexer';
import parse from 'pug-parser';
import { registry } from 'olymp-slate';

var map = {
  col: 'column',
  cols: 'columns',
  p: 'paragraph',
  a: 'link',
  h1: 'heading-one',
  h2: 'heading-two',
  h3: 'heading-three',
  h4: 'heading-four',
  h5: 'heading-five',
  h6: 'heading-six',
  link: function link(node) {
    node.kind = 'inline';
    return node;
  },
  gql: function gql(node) {
    var text = node.nodes.filter(function (x) {
      return x.leaves[0].text !== '\n';
    }).map(function (x) {
      return x.leaves[0].text;
    }).join('\n');
    node.type = 'graphiql';
    node.isVoid = true;
    node.data.query = text;
    console.log(text);
    return node;
  },
  code: function code(node) {
    node.nodes = node.nodes.filter(function (x) {
      return x.leaves[0].text !== '\n';
    }).map(function (x) {
      return {
        type: 'code-line',
        kind: 'block',
        nodes: [x]
      };
    });
    return node;
  },
  table: function table(node) {
    if (node.data && node.data.columns) {
      node.data.columns = node.data.columns.split('|');
    }
    node.nodes = node.nodes.filter(function (x) {
      return x.leaves[0].text !== '\n' && x.leaves[0].text !== '';
    }).map(function (x) {
      return {
        type: 'table-row',
        kind: 'block',
        nodes: x.leaves[0].text.split('|').map(function (text) {
          return {
            type: 'table-data',
            kind: 'block',
            nodes: [{
              kind: 'text',
              leaves: [{
                kind: 'leaf',
                text: text
              }]
            }]
          };
        })
      };
    });
    return node;
  }
};

var convert = function convert(src) {
  var v = parse(lex(src), { src: src });
  var convertNode = function convertNode(_ref) {
    var type = _ref.type,
        name = _ref.name,
        _ref$attrs = _ref.attrs,
        attrs = _ref$attrs === undefined ? [] : _ref$attrs,
        block = _ref.block,
        val = _ref.val;

    if (type === 'Tag') {
      name = map[name] && typeof map[name] === 'string' ? map[name] : name;
      var reg = registry.blocks[name] || {};
      var node = {
        isVoid: reg.isVoid,
        type: name,
        kind: 'block',
        data: attrs.reduce(function (r, i) {
          var val = i.val;
          if (typeof val === 'string' && val.charAt(0) === '"' && val.charAt(val.length - 1) === '"') {
            val = val.substr(1, val.length - 2);
          } else if (typeof val === 'string' && val.charAt(0) === "'" && val.charAt(val.length - 1) === "'") {
            val = val.substr(1, val.length - 2);
          }
          return _extends({}, r, _defineProperty({}, i.name, val));
        }, {}),
        nodes: block && block.nodes && block.nodes.map(convertNode).filter(function (x) {
          return x;
        })
      };
      return map[name] && typeof map[name] === 'function' && map[name](node) || node;
    } else if (type === 'Text') {
      return {
        kind: 'text',
        leaves: [{ kind: 'leaf', text: val }]
      };
    }
  };
  return { nodes: v.nodes.map(convertNode).filter(function (x) {
      return x;
    }) };
};

export default convert;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2thZ2VzL3NsYXRlL3B1Zy90by1zbGF0ZS9jb252ZXJ0LmVzNiJdLCJuYW1lcyI6WyJsZXgiLCJwYXJzZSIsInJlZ2lzdHJ5IiwibWFwIiwiY29sIiwiY29scyIsInAiLCJhIiwiaDEiLCJoMiIsImgzIiwiaDQiLCJoNSIsImg2IiwibGluayIsIm5vZGUiLCJraW5kIiwiZ3FsIiwidGV4dCIsIm5vZGVzIiwiZmlsdGVyIiwieCIsImxlYXZlcyIsImpvaW4iLCJ0eXBlIiwiaXNWb2lkIiwiZGF0YSIsInF1ZXJ5IiwiY29uc29sZSIsImxvZyIsImNvZGUiLCJ0YWJsZSIsImNvbHVtbnMiLCJzcGxpdCIsImNvbnZlcnQiLCJ2Iiwic3JjIiwiY29udmVydE5vZGUiLCJuYW1lIiwiYXR0cnMiLCJibG9jayIsInZhbCIsInJlZyIsImJsb2NrcyIsInJlZHVjZSIsInIiLCJpIiwiY2hhckF0IiwibGVuZ3RoIiwic3Vic3RyIl0sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBT0EsR0FBUCxNQUFnQixXQUFoQjtBQUNBLE9BQU9DLEtBQVAsTUFBa0IsWUFBbEI7QUFDQSxTQUFTQyxRQUFULFFBQXlCLGFBQXpCOztBQUVBLElBQU1DLE1BQU07QUFDVkMsT0FBSyxRQURLO0FBRVZDLFFBQU0sU0FGSTtBQUdWQyxLQUFHLFdBSE87QUFJVkMsS0FBRyxNQUpPO0FBS1ZDLE1BQUksYUFMTTtBQU1WQyxNQUFJLGFBTk07QUFPVkMsTUFBSSxlQVBNO0FBUVZDLE1BQUksY0FSTTtBQVNWQyxNQUFJLGNBVE07QUFVVkMsTUFBSSxhQVZNO0FBV1ZDLFFBQU0sb0JBQVE7QUFDWkMsU0FBS0MsSUFBTCxHQUFZLFFBQVo7QUFDQSxXQUFPRCxJQUFQO0FBQ0QsR0FkUztBQWVWRSxPQUFLLG1CQUFRO0FBQ1gsUUFBTUMsT0FBT0gsS0FBS0ksS0FBTCxDQUNWQyxNQURVLENBQ0g7QUFBQSxhQUFLQyxFQUFFQyxNQUFGLENBQVMsQ0FBVCxFQUFZSixJQUFaLEtBQXFCLElBQTFCO0FBQUEs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TFIsY0FBTSxNQUREO0FBRUxNLGdCQUFRLENBQUMsRUFBRU4sTUFBTSxNQUFSLEVBQWdCRSxNQUFNdUIsR0FBdEIsRUFBRDtBQUZILE9BQVA7QUFJRDtBQUNGLEdBdENEO0FBdUNBLFNBQU8sRUFBRXRCLE9BQU9nQixFQUFFaEIsS0FBRixDQUFRaEIsR0FBUixDQUFZa0MsV0FBWixFQUF5QmpCLE1BQXpCLENBQWdDO0FBQUEsYUFBS0MsQ0FBTDtBQUFBLEtBQWhDLENBQVQsRUFBUDtBQUNELENBMUNEOztBQTRDQSxlQUFlYSxPQUFmIiwiZmlsZSI6InBhY2thZ2VzL3NsYXRlL3B1Zy90by1zbGF0ZS9jb252ZXJ0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxleCBmcm9tICdwdWctbGV4ZXInO1xuaW1wb3J0IHBhcnNlIGZyb20gJ3B1Zy1wYXJzZXInO1xuaW1wb3J0IHsgcmVnaXN0cnkgfSBmcm9tICdvbHltcC1zbGF0ZSc7XG5cbmNvbnN0IG1hcCA9IHtcbiAgY29sOiAnY29sdW1uJyxcbiAgY29sczogJ2NvbHVtbnMnLFxuICBwOiAncGFyYWdyYXBoJyxcbiAgYTogJ2xpbmsnLFxuICBoMTogJ2hlYWRpbmctb25lJyxcbiAgaDI6ICdoZWFkaW5nLXR3bycsXG4gIGgzOiAnaGVhZGluZy10aHJlZScsXG4gIGg0OiAnaGVhZGluZy1mb3VyJyxcbiAgaDU6ICdoZWFkaW5nLWZpdmUnLFxuICBoNjogJ2hlYWRpbmctc2l4JyxcbiAgbGluazogbm9kZSA9PiB7XG4gICAgbm9kZS5raW5kID0gJ2lubGluZSc7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH0sXG4gIGdxbDogbm9kZSA9PiB7XG4gICAgY29uc3QgdGV4dCA9IG5vZGUubm9kZXNcbiAgICAgIC5maWx0ZXIoeCA9PiB4LmxlYXZlc1swXS50ZXh0ICE9PSAnXFxuJylcbiAgICAgIC5tYXAoeCA9PiB4LmxlYXZlc1swXS50ZXh0KVxuICAgICAgLmpvaW4oJ1xcbicpO1xuICAgIG5vZGUudHlwZSA9ICdncmFwaGlxbCc7XG4gICAgbm9kZS5pc1ZvaWQgPSB0cnVlO1xuICAgIG5vZGUuZGF0YS5xdWVyeSA9IHRleHQ7XG4gICAgY29uc29sZS5sb2codGV4dCk7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH0sXG4gIGNvZGU6IG5vZGUgPT4ge1xuICAgIG5vZGUubm9kZXMgPSBub2RlLm5vZGVzLmZpbHRlcih4ID0+IHgubGVhdmVzWzBdLnRleHQgIT09ICdcXG4nKS5tYXAoeCA9PiAoe1xuICAgICAgdHlwZTogJ2NvZGUtbGluZScsXG4gICAgICBraW5kOiAnYmxvY2snLFxuICAgICAgbm9kZXM6IFt4XSxcbiAgICB9KSk7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH0sXG4gIHRhYmxlOiBub2RlID0+IHtcbiAgICBpZiAobm9kZS5kYXRhICYmIG5vZGUuZGF0YS5jb2x1bW5zKSB7XG4gICAgICBub2RlLmRhdGEuY29sdW1ucyA9IG5vZGUuZGF0YS5jb2x1bW5zLnNwbGl0KCd8Jyk7XG4gICAgfVxuICAgIG5vZGUubm9kZXMgPSBub2RlLm5vZGVzXG4gICAgICAuZmlsdGVyKHggPT4geC5sZWF2ZXNbMF0udGV4dCAhPT0gJ1xcbicgJiYgeC5sZWF2ZXNbMF0udGV4dCAhPT0gJycpXG4gICAgICAubWFwKHggPT4gKHtcbiAgICAgICAgdHlwZTogJ3RhYmxlLXJvdycsXG4gICAgICAgIGtpbmQ6ICdibG9jaycsXG4gICAgICAgIG5vZGVzOiB4LmxlYXZlc1swXS50ZXh0LnNwbGl0KCd8JykubWFwKHRleHQgPT4gKHtcbiAgICAgICAgICB0eXBlOiAndGFibGUtZGF0YScsXG4gICAgICAgICAga2luZDogJ2Jsb2NrJyxcbiAgICAgICAgICBub2RlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBraW5kOiAndGV4dCcsXG4gICAgICAgICAgICAgIGxlYXZlczogW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGtpbmQ6ICdsZWFmJyxcbiAgICAgICAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgfSkpLFxuICAgICAgfSkpO1xuICAgIHJldHVybiBub2RlO1xuICB9LFxufTtcblxuY29uc3QgY29udmVydCA9IHNyYyA9PiB7XG4gIGNvbnN0IHYgPSBwYXJzZShsZXgoc3JjKSwgeyBzcmMgfSk7XG4gIGNvbnN0IGNvbnZlcnROb2RlID0gKHsgdHlwZSwgbmFtZSwgYXR0cnMgPSBbXSwgYmxvY2ssIHZhbCB9KSA9PiB7XG4gICAgaWYgKHR5cGUgPT09ICdUYWcnKSB7XG4gICAgICBuYW1lID0gbWFwW25hbWVdICYmIHR5cGVvZiBtYXBbbmFtZV0gPT09ICdzdHJpbmcnID8gbWFwW25hbWVdIDogbmFtZTtcbiAgICAgIGNvbnN0IHJlZyA9IHJlZ2lzdHJ5LmJsb2Nrc1tuYW1lXSB8fCB7fTtcbiAgICAgIGNvbnN0IG5vZGUgPSB7XG4gICAgICAgIGlzVm9pZDogcmVnLmlzVm9pZCxcbiAgICAgICAgdHlwZTogbmFtZSxcbiAgICAgICAga2luZDogJ2Jsb2NrJyxcbiAgICAgICAgZGF0YTogYXR0cnMucmVkdWNlKChyLCBpKSA9PiB7XG4gICAgICAgICAgbGV0IHZhbCA9IGkudmFsO1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICB2YWwuY2hhckF0KDApID09PSAnXCInICYmXG4gICAgICAgICAgICB2YWwuY2hhckF0KHZhbC5sZW5ndGggLSAxKSA9PT0gJ1wiJ1xuICAgICAgICAgICkge1xuICAgICAgICAgICAgdmFsID0gdmFsLnN1YnN0cigxLCB2YWwubGVuZ3RoIC0gMik7XG4gICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnICYmXG4gICAgICAgICAgICB2YWwuY2hhckF0KDApID09PSBcIidcIiAmJlxuICAgICAgICAgICAgdmFsLmNoYXJBdCh2YWwubGVuZ3RoIC0gMSkgPT09IFwiJ1wiXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICB2YWwgPSB2YWwuc3Vic3RyKDEsIHZhbC5sZW5ndGggLSAyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHsgLi4uciwgW2kubmFtZV06IHZhbCB9O1xuICAgICAgICB9LCB7fSksXG4gICAgICAgIG5vZGVzOlxuICAgICAgICAgIGJsb2NrICYmIGJsb2NrLm5vZGVzICYmIGJsb2NrLm5vZGVzLm1hcChjb252ZXJ0Tm9kZSkuZmlsdGVyKHggPT4geCksXG4gICAgICB9O1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgKG1hcFtuYW1lXSAmJiB0eXBlb2YgbWFwW25hbWVdID09PSAnZnVuY3Rpb24nICYmIG1hcFtuYW1lXShub2RlKSkgfHxcbiAgICAgICAgbm9kZVxuICAgICAgKTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICdUZXh0Jykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAga2luZDogJ3RleHQnLFxuICAgICAgICBsZWF2ZXM6IFt7IGtpbmQ6ICdsZWFmJywgdGV4dDogdmFsIH1dLFxuICAgICAgfTtcbiAgICB9XG4gIH07XG4gIHJldHVybiB7IG5vZGVzOiB2Lm5vZGVzLm1hcChjb252ZXJ0Tm9kZSkuZmlsdGVyKHggPT4geCkgfTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNvbnZlcnQ7XG4iXX0=
