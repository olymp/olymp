'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var jwt = require('express-jwt');
var jwksRsa = require('jwks-rsa');
var hasScope = require('express-jwt-authz');

exports.default = function () {
  var ensureAuth = jwt({
    // Dynamically provide a signing key based on the kid in the header and the singing keys provided by the JWKS endpoint.
    secret: jwksRsa.expressJwtSecret({
      cache: true,
      rateLimit: true,
      jwksRequestsPerMinute: 5,
      jwksUri: 'https://' + process.env.AUTH0_DOMAIN + '/.well-known/jwks.json'
    }),

    // Validate the audience and the issuer.
    audience: process.env.AUTH0_AUDIENCE || 'graphql',
    issuer: process.env.AUTH0_DOMAIN,
    algorithms: ['RS256']
  });

  return [ensureAuth, function (req, res, next) {
    req.hasScope = hasScope;
    next();
  }];
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNtcy9hdXRoMC9zZXJ2ZXIvaW5kZXguZXM2Il0sIm5hbWVzIjpbImp3dCIsInJlcXVpcmUiLCJqd2tzUnNhIiwiaGFzU2NvcGUiLCJlbnN1cmVBdXRoIiwic2VjcmV0IiwiZXhwcmVzc0p3dFNlY3JldCIsImNhY2hlIiwicmF0ZUxpbWl0Iiwiandrc1JlcXVlc3RzUGVyTWludXRlIiwiandrc1VyaSIsInByb2Nlc3MiLCJlbnYiLCJBVVRIMF9ET01BSU4iLCJhdWRpZW5jZSIsIkFVVEgwX0FVRElFTkNFIiwiaXNzdWVyIiwiYWxnb3JpdGhtcyIsInJlcSIsInJlcyIsIm5leHQiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBTUEsTUFBTUMsUUFBUSxhQUFSLENBQVo7QUFDQSxJQUFNQyxVQUFVRCxRQUFRLFVBQVIsQ0FBaEI7QUFDQSxJQUFNRSxXQUFXRixRQUFRLG1CQUFSLENBQWpCOztrQkFFZSxZQUFNO0FBQ25CLE1BQU1HLGFBQWFKLElBQUk7QUFDckI7QUFDQUssWUFBUUgsUUFBUUksZ0JBQVIsQ0FBeUI7QUFDL0JDLGFBQU8sSUFEd0I7QUFFL0JDLGlCQUFXLElBRm9CO0FBRy9CQyw2QkFBdUIsQ0FIUTtBQUkvQkMsNEJBQW9CQyxRQUFRQyxHQUFSLENBQVlDLFlBQWhDO0FBSitCLEtBQXpCLENBRmE7O0FBU3JCO0FBQ0FDLGNBQVVILFFBQVFDLEdBQVIsQ0FBWUcsY0FBWixJQUE4QixTQVZuQjtBQVdyQkMsWUFBUUwsUUFBUUMsR0FBUixDQUFZQyxZQVhDO0FBWXJCSSxnQkFBWSxDQUFDLE9BQUQ7QUFaUyxHQUFKLENBQW5COztBQWVBLFNBQU8sQ0FDTGIsVUFESyxFQUVMLFVBQUNjLEdBQUQsRUFBTUMsR0FBTixFQUFXQyxJQUFYLEVBQW9CO0FBQ2xCRixRQUFJZixRQUFKLEdBQWVBLFFBQWY7QUFDQWlCO0FBQ0QsR0FMSSxDQUFQO0FBT0QsQyIsImZpbGUiOiJjbXMvYXV0aDAvc2VydmVyL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID0gcmVxdWlyZSgnZXhwcmVzcy1qd3QnKTtcbmNvbnN0IGp3a3NSc2EgPSByZXF1aXJlKCdqd2tzLXJzYScpO1xuY29uc3QgaGFzU2NvcGUgPSByZXF1aXJlKCdleHByZXNzLWp3dC1hdXRoeicpO1xuXG5leHBvcnQgZGVmYXVsdCAoKSA9PiB7XG4gIGNvbnN0IGVuc3VyZUF1dGggPSBqd3Qoe1xuICAgIC8vIER5bmFtaWNhbGx5IHByb3ZpZGUgYSBzaWduaW5nIGtleSBiYXNlZCBvbiB0aGUga2lkIGluIHRoZSBoZWFkZXIgYW5kIHRoZSBzaW5naW5nIGtleXMgcHJvdmlkZWQgYnkgdGhlIEpXS1MgZW5kcG9pbnQuXG4gICAgc2VjcmV0OiBqd2tzUnNhLmV4cHJlc3NKd3RTZWNyZXQoe1xuICAgICAgY2FjaGU6IHRydWUsXG4gICAgICByYXRlTGltaXQ6IHRydWUsXG4gICAgICBqd2tzUmVxdWVzdHNQZXJNaW51dGU6IDUsXG4gICAgICBqd2tzVXJpOiBgaHR0cHM6Ly8ke3Byb2Nlc3MuZW52LkFVVEgwX0RPTUFJTn0vLndlbGwta25vd24vandrcy5qc29uYFxuICAgIH0pLFxuXG4gICAgLy8gVmFsaWRhdGUgdGhlIGF1ZGllbmNlIGFuZCB0aGUgaXNzdWVyLlxuICAgIGF1ZGllbmNlOiBwcm9jZXNzLmVudi5BVVRIMF9BVURJRU5DRSB8fCAnZ3JhcGhxbCcsXG4gICAgaXNzdWVyOiBwcm9jZXNzLmVudi5BVVRIMF9ET01BSU4sXG4gICAgYWxnb3JpdGhtczogWydSUzI1NiddXG4gIH0pO1xuXG4gIHJldHVybiBbXG4gICAgZW5zdXJlQXV0aCxcbiAgICAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIHJlcS5oYXNTY29wZSA9IGhhc1Njb3BlO1xuICAgICAgbmV4dCgpO1xuICAgIH0sXG4gIF07XG59O1xuIl19
