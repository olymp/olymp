'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var jwt = require('express-jwt');
var jwksRsa = require('jwks-rsa');
var hasScope = require('express-jwt-authz');

exports.default = function () {
  var ensureAuth = jwt({
    // Dynamically provide a signing key based on the kid in the header and the singing keys provided by the JWKS endpoint.
    secret: jwksRsa.expressJwtSecret({
      cache: true,
      rateLimit: true,
      jwksRequestsPerMinute: 5,
      jwksUri: 'https://' + process.env.AUTH0_DOMAIN + '/.well-known/jwks.json'
    }),

    // Validate the audience and the issuer.
    audience: process.env.AUTH0_AUDIENCE || 'graphql',
    issuer: process.env.AUTH0_DOMAIN,
    algorithms: ['RS256']
  });

  return [ensureAuth, function (req, res, next) {
    req.hasScope = hasScope;
    next();
  }];
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2thZ2VzL2F1dGgwL3NlcnZlci9pbmRleC5lczYiXSwibmFtZXMiOlsiand0IiwicmVxdWlyZSIsImp3a3NSc2EiLCJoYXNTY29wZSIsImVuc3VyZUF1dGgiLCJzZWNyZXQiLCJleHByZXNzSnd0U2VjcmV0IiwiY2FjaGUiLCJyYXRlTGltaXQiLCJqd2tzUmVxdWVzdHNQZXJNaW51dGUiLCJqd2tzVXJpIiwicHJvY2VzcyIsImVudiIsIkFVVEgwX0RPTUFJTiIsImF1ZGllbmNlIiwiQVVUSDBfQVVESUVOQ0UiLCJpc3N1ZXIiLCJhbGdvcml0aG1zIiwicmVxIiwicmVzIiwibmV4dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxJQUFNQSxNQUFNQyxRQUFRLGFBQVIsQ0FBWjtBQUNBLElBQU1DLFVBQVVELFFBQVEsVUFBUixDQUFoQjtBQUNBLElBQU1FLFdBQVdGLFFBQVEsbUJBQVIsQ0FBakI7O2tCQUVlLFlBQU07QUFDbkIsTUFBTUcsYUFBYUosSUFBSTtBQUNyQjtBQUNBSyxZQUFRSCxRQUFRSSxnQkFBUixDQUF5QjtBQUMvQkMsYUFBTyxJQUR3QjtBQUUvQkMsaUJBQVcsSUFGb0I7QUFHL0JDLDZCQUF1QixDQUhRO0FBSS9CQyw0QkFBb0JDLFFBQVFDLEdBQVIsQ0FBWUMsWUFBaEM7QUFKK0IsS0FBekIsQ0FGYTs7QUFTckI7QUFDQUMsY0FBVUgsUUFBUUMsR0FBUixDQUFZRyxjQUFaLElBQThCLFNBVm5CO0FBV3JCQyxZQUFRTCxRQUFRQyxHQUFSLENBQVlDLFlBWEM7QUFZckJJLGdCQUFZLENBQUMsT0FBRDtBQVpTLEdBQUosQ0FBbkI7O0FBZUEsU0FBTyxDQUNMYixVQURLLEVBRUwsVUFBQ2MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLElBQVgsRUFBb0I7QUFDbEJGLFFBQUlmLFFBQUosR0FBZUEsUUFBZjtBQUNBaUI7QUFDRCxHQUxJLENBQVA7QUFPRCxDIiwiZmlsZSI6InBhY2thZ2VzL2F1dGgwL3NlcnZlci9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGp3dCA9IHJlcXVpcmUoJ2V4cHJlc3Mtand0Jyk7XG5jb25zdCBqd2tzUnNhID0gcmVxdWlyZSgnandrcy1yc2EnKTtcbmNvbnN0IGhhc1Njb3BlID0gcmVxdWlyZSgnZXhwcmVzcy1qd3QtYXV0aHonKTtcblxuZXhwb3J0IGRlZmF1bHQgKCkgPT4ge1xuICBjb25zdCBlbnN1cmVBdXRoID0gand0KHtcbiAgICAvLyBEeW5hbWljYWxseSBwcm92aWRlIGEgc2lnbmluZyBrZXkgYmFzZWQgb24gdGhlIGtpZCBpbiB0aGUgaGVhZGVyIGFuZCB0aGUgc2luZ2luZyBrZXlzIHByb3ZpZGVkIGJ5IHRoZSBKV0tTIGVuZHBvaW50LlxuICAgIHNlY3JldDogandrc1JzYS5leHByZXNzSnd0U2VjcmV0KHtcbiAgICAgIGNhY2hlOiB0cnVlLFxuICAgICAgcmF0ZUxpbWl0OiB0cnVlLFxuICAgICAgandrc1JlcXVlc3RzUGVyTWludXRlOiA1LFxuICAgICAgandrc1VyaTogYGh0dHBzOi8vJHtwcm9jZXNzLmVudi5BVVRIMF9ET01BSU59Ly53ZWxsLWtub3duL2p3a3MuanNvbmBcbiAgICB9KSxcblxuICAgIC8vIFZhbGlkYXRlIHRoZSBhdWRpZW5jZSBhbmQgdGhlIGlzc3Vlci5cbiAgICBhdWRpZW5jZTogcHJvY2Vzcy5lbnYuQVVUSDBfQVVESUVOQ0UgfHwgJ2dyYXBocWwnLFxuICAgIGlzc3VlcjogcHJvY2Vzcy5lbnYuQVVUSDBfRE9NQUlOLFxuICAgIGFsZ29yaXRobXM6IFsnUlMyNTYnXVxuICB9KTtcblxuICByZXR1cm4gW1xuICAgIGVuc3VyZUF1dGgsXG4gICAgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICByZXEuaGFzU2NvcGUgPSBoYXNTY29wZTtcbiAgICAgIG5leHQoKTtcbiAgICB9LFxuICBdO1xufTtcbiJdfQ==
