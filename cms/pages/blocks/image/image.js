function _objectWithoutProperties(obj, keys) { var target = {}; for (var i in obj) { if (keys.indexOf(i) >= 0) continue; if (!Object.prototype.hasOwnProperty.call(obj, i)) continue; target[i] = obj[i]; } return target; }

import React from 'react';
import { LightboxImage, Image, EditText } from 'olymp-cloudinary';
import cn from 'classnames';
import FaAlignLeft from 'olymp-icons/lib/fa-align-left';
import FaAlignRight from 'olymp-icons/lib/fa-align-right';
import FaPlus from 'olymp-icons/lib/fa-plus';
import FaMinus from 'olymp-icons/lib/fa-minus';

import { Inline, Block } from 'slate';

export default {
  type: 'image',
  isVoid: true,
  kind: 'block',
  label: 'Bild',
  category: 'Bilder',
  component: function component(_ref) {
    var node = _ref.node,
        className = _ref.className,
        editor = _ref.editor,
        attributes = _ref.attributes,
        children = _ref.children;

    var Img = editor.props.readOnly === true ? LightboxImage : Image;
    var value = node.data.get('value') || {
      width: 400,
      height: 300
    };
    var size = node.data.get('size') || 4;
    return React.createElement(
      Img,
      {
        attributes: attributes,
        className: cn(className, 'image-block'),
        width: 100 / size + '%',
        value: value
      },
      children
    );
  },
  styles: function styles(_ref2) {
    var theme = _ref2.theme,
        getData = _ref2.getData;

    var alignment = getData('float', 'none');
    var normalized = alignment.replace('+', '');
    return {
      float: normalized,
      margin: alignment === 'none' && '0 auto',
      marginTop: alignment === 'none' && theme.space3,
      marginBottom: theme.space3,
      zIndex: 1,
      extend: [{
        condition: normalized === 'left',
        style: { marginRight: theme.space3 }
      }, {
        condition: alignment === 'left+',
        style: { marginLeft: -75 }
      }, {
        condition: normalized === 'right',
        style: { marginLeft: theme.space3 }
      }, {
        condition: alignment === 'right+',
        style: { marginRight: -75 }
      }]
    };
  },
  actions: [{
    tooltip: function tooltip(getData) {
      return 'Bild ' + (getData('value') ? 'wechseln' : 'wählen');
    },
    component: function component(_ref3) {
      var setData = _ref3.setData,
          getData = _ref3.getData,
          p = _objectWithoutProperties(_ref3, ['setData', 'getData']);

      return React.createElement(EditText, {
        onChange: function onChange(value) {
          return setData({ value: value });
        },
        value: getData('value', {}),
        multi: false
      });
    },
    toggle: function toggle() {}
  }, {
    label: React.createElement(FaAlignLeft, null),
    tooltip: 'Links anordnen',
    active: function active(_ref4) {
      var getData = _ref4.getData;
      return getData('float', 'none').indexOf('left') === 0;
    },
    toggle: function toggle(_ref5) {
      var value = _ref5.value,
          onChange = _ref5.onChange,
          node = _ref5.node;

      var alignment = node.data.get('float') || 'none';
      if (alignment === 'none') {
        onChange(value.change().removeNodeByKey(node.key).collapseToStartOfNextBlock().insertInline(Inline.create({
          type: node.type,
          isVoid: node.isVoid,
          data: node.data.set('float', 'left')
        })));
      } else if (alignment === 'left') {
        onChange(value.change().removeNodeByKey(node.key).insertInline(Inline.create({
          type: node.type,
          isVoid: node.isVoid,
          data: node.data.set('float', 'left+')
        })));
      } else {
        onChange(value.change().removeNodeByKey(node.key).insertBlock(Block.create({
          type: node.type,
          isVoid: node.isVoid,
          data: node.data.set('float', null)
        })));
      }
    }
  }, {
    label: React.createElement(FaAlignRight, null),
    tooltip: 'Rechts anordnen',
    active: function active(_ref6) {
      var getData = _ref6.getData;
      return getData('float', 'none').indexOf('right') === 0;
    },
    toggle: function toggle(_ref7) {
      var value = _ref7.value,
          onChange = _ref7.onChange,
          node = _ref7.node;

      var alignment = node.data.get('float') || 'none';

      if (alignment === 'none') {
        onChange(value.change().removeNodeByKey(node.key).insertInline(Inline.create({
          type: node.type,
          isVoid: node.isVoid,
          data: node.data.set('float', 'right')
        })));
      } else if (alignment === 'right') {
        onChange(value.change().removeNodeByKey(node.key).insertInline(Inline.create({
          type: node.type,
          isVoid: node.isVoid,
          data: node.data.set('float', 'right+')
        })));
      } else {
        onChange(value.change().removeNodeByKey(node.key).insertBlock(Block.create({
          type: node.type,
          isVoid: node.isVoid,
          data: node.data.set('float', null)
        })));
      }
    }
  }, {
    label: React.createElement(FaPlus, null),
    tooltip: 'Größer',
    toggle: function toggle(_ref8) {
      var setData = _ref8.setData,
          getData = _ref8.getData;

      var size = getData('size', 4);
      setData({
        size: size > 1 ? size - 1 : 1
      });
    }
  }, {
    label: React.createElement(FaMinus, null),
    tooltip: 'Kleiner',
    toggle: function toggle(_ref9) {
      var setData = _ref9.setData,
          getData = _ref9.getData;

      var size = getData('size', 4);
      setData({
        size: size < 8 ? size + 1 : 8
      });
    }
  }]
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2thZ2VzL3BhZ2VzL2Jsb2Nrcy9pbWFnZS9pbWFnZS5lczYiXSwibmFtZXMiOlsiUmVhY3QiLCJMaWdodGJveEltYWdlIiwiSW1hZ2UiLCJFZGl0VGV4dCIsImNuIiwiSW5saW5lIiwiQmxvY2siLCJ0eXBlIiwiaXNWb2lkIiwia2luZCIsImxhYmVsIiwiY2F0ZWdvcnkiLCJjb21wb25lbnQiLCJub2RlIiwiY2xhc3NOYW1lIiwiZWRpdG9yIiwiYXR0cmlidXRlcyIsImNoaWxkcmVuIiwiSW1nIiwicHJvcHMiLCJyZWFkT25seSIsInZhbHVlIiwiZGF0YSIsImdldCIsIndpZHRoIiwiaGVpZ2h0Iiwic2l6ZSIsInN0eWxlcyIsInRoZW1lIiwiZ2V0RGF0YSIsImFsaWdubWVudCIsIm5vcm1hbGl6ZWQiLCJyZXBsYWNlIiwiZmxvYXQiLCJtYXJnaW4iLCJtYXJnaW5Ub3AiLCJzcGFjZTMiLCJtYXJnaW5Cb3R0b20iLCJ6SW5kZXgiLCJleHRlbmQiLCJjb25kaXRpb24iLCJzdHlsZSIsIm1hcmdpblJpZ2h0IiwibWFyZ2luTGVmdCIsImFjdGlvbnMiLCJ0b29sdGlwIiwic2V0RGF0YSIsInAiLCJ0b2dnbGUiLCJhY3RpdmUiLCJpbmRleE9mIiwib25DaGFuZ2UiLCJjaGFuZ2UiLCJyZW1vdmVOb2RlQnlLZXkiLCJrZXkiLCJjb2xsYXBzZVRvU3RhcnRPZk5leHRCbG9jayIsImluc2VydElubGluZSIsImNyZWF0ZSIsInNldCIsImluc2VydEJsb2NrIl0sIm1hcHBpbmdzIjoiOztBQUFBLE9BQU9BLEtBQVAsTUFBa0IsT0FBbEI7QUFDQSxTQUFTQyxhQUFULEVBQXdCQyxLQUF4QixFQUErQkMsUUFBL0IsUUFBK0Msa0JBQS9DO0FBQ0EsT0FBT0MsRUFBUCxNQUFlLFlBQWY7Ozs7OztBQUVBLFNBQVNDLE1BQVQsRUFBaUJDLEtBQWpCLFFBQThCLE9BQTlCOztBQUVBLGVBQWU7QUFDYkMsUUFBTSxPQURPO0FBRWJDLFVBQVEsSUFGSztBQUdiQyxRQUFNLE9B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QUFDTFAsaUJBQ0U5QixNQUNHK0IsTUFESCxHQUVHQyxlQUZILENBRW1CeEMsS0FBS3lDLEdBRnhCLEVBR0dLLFdBSEgsQ0FJSXJELE1BQU1tRCxNQUFOLENBQWE7QUFDWGxELGdCQUFNTSxLQUFLTixJQURBO0FBRVhDLGtCQUFRSyxLQUFLTCxNQUZGO0FBR1hjLGdCQUFNVCxLQUFLUyxJQUFMLENBQVVvQyxHQUFWLENBQWMsT0FBZCxFQUF1QixJQUF2QjtBQUhLLFNBQWIsQ0FKSixDQURGO0FBWUQ7QUFDRjtBQS9DSCxHQTdETyxFQThHUDtBQUNFaEQsV0FBTyxvQkFBQyxNQUFELE9BRFQ7QUFFRW1DLGFBQVMsUUFGWDtBQUdFRyxZQUFRLHVCQUEwQjtBQUFBLFVBQXZCRixPQUF1QixTQUF2QkEsT0FBdUI7QUFBQSxVQUFkakIsT0FBYyxTQUFkQSxPQUFjOztBQUNoQyxVQUFNSCxPQUFPRyxRQUFRLE1BQVIsRUFBZ0IsQ0FBaEIsQ0FBYjtBQUNBaUIsY0FBUTtBQUNOcEIsY0FBTUEsT0FBTyxDQUFQLEdBQVdBLE9BQU8sQ0FBbEIsR0FBc0I7QUFEdEIsT0FBUjtBQUdEO0FBUkgsR0E5R08sRUF3SFA7QUFDRWhCLFdBQU8sb0JBQUMsT0FBRCxPQURUO0FBRUVtQyxhQUFTLFNBRlg7QUFHRUcsWUFBUSx1QkFBMEI7QUFBQSxVQUF2QkYsT0FBdUIsU0FBdkJBLE9BQXVCO0FBQUEsVUFBZGpCLE9BQWMsU0FBZEEsT0FBYzs7QUFDaEMsVUFBTUgsT0FBT0csUUFBUSxNQUFSLEVBQWdCLENBQWhCLENBQWI7QUFDQWlCLGNBQVE7QUFDTnBCLGNBQU1BLE9BQU8sQ0FBUCxHQUFXQSxPQUFPLENBQWxCLEdBQXNCO0FBRHRCLE9BQVI7QUFHRDtBQVJILEdBeEhPO0FBckRJLENBQWYiLCJmaWxlIjoicGFja2FnZXMvcGFnZXMvYmxvY2tzL2ltYWdlL2ltYWdlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IExpZ2h0Ym94SW1hZ2UsIEltYWdlLCBFZGl0VGV4dCB9IGZyb20gJ29seW1wLWNsb3VkaW5hcnknO1xuaW1wb3J0IGNuIGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0IHsgRmFBbGlnbkxlZnQsIEZhQWxpZ25SaWdodCwgRmFQbHVzLCBGYU1pbnVzIH0gZnJvbSAnb2x5bXAtaWNvbnMnO1xuaW1wb3J0IHsgSW5saW5lLCBCbG9jayB9IGZyb20gJ3NsYXRlJztcblxuZXhwb3J0IGRlZmF1bHQge1xuICB0eXBlOiAnaW1hZ2UnLFxuICBpc1ZvaWQ6IHRydWUsXG4gIGtpbmQ6ICdibG9jaycsXG4gIGxhYmVsOiAnQmlsZCcsXG4gIGNhdGVnb3J5OiAnQmlsZGVyJyxcbiAgY29tcG9uZW50OiAoeyBub2RlLCBjbGFzc05hbWUsIGVkaXRvciwgYXR0cmlidXRlcywgY2hpbGRyZW4gfSkgPT4ge1xuICAgIGNvbnN0IEltZyA9IGVkaXRvci5wcm9wcy5yZWFkT25seSA9PT0gdHJ1ZSA/IExpZ2h0Ym94SW1hZ2UgOiBJbWFnZTtcbiAgICBjb25zdCB2YWx1ZSA9IG5vZGUuZGF0YS5nZXQoJ3ZhbHVlJykgfHwge1xuICAgICAgd2lkdGg6IDQwMCxcbiAgICAgIGhlaWdodDogMzAwLFxuICAgIH07XG4gICAgY29uc3Qgc2l6ZSA9IG5vZGUuZGF0YS5nZXQoJ3NpemUnKSB8fCA0O1xuICAgIHJldHVybiAoXG4gICAgICA8SW1nXG4gICAgICAgIGF0dHJpYnV0ZXM9e2F0dHJpYnV0ZXN9XG4gICAgICAgIGNsYXNzTmFtZT17Y24oY2xhc3NOYW1lLCAnaW1hZ2UtYmxvY2snKX1cbiAgICAgICAgd2lkdGg9e2AkezEwMCAvIHNpemV9JWB9XG4gICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgID5cbiAgICAgICAge2NoaWxkcmVufVxuICAgICAgPC9JbWc+XG4gICAgKTtcbiAgfSxcbiAgc3R5bGVzOiAoeyB0aGVtZSwgZ2V0RGF0YSB9KSA9PiB7XG4gICAgY29uc3QgYWxpZ25tZW50ID0gZ2V0RGF0YSgnZmxvYXQnLCAnbm9uZScpO1xuICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBhbGlnbm1lbnQucmVwbGFjZSgnKycsICcnKTtcbiAgICByZXR1cm4ge1xuICAgICAgZmxvYXQ6IG5vcm1hbGl6ZWQsXG4gICAgICBtYXJnaW46IGFsaWdubWVudCA9PT0gJ25vbmUnICYmICcwIGF1dG8nLFxuICAgICAgbWFyZ2luVG9wOiBhbGlnbm1lbnQgPT09ICdub25lJyAmJiB0aGVtZS5zcGFjZTMsXG4gICAgICBtYXJnaW5Cb3R0b206IHRoZW1lLnNwYWNlMyxcbiAgICAgIHpJbmRleDogMSxcbiAgICAgIGV4dGVuZDogW1xuICAgICAgICB7XG4gICAgICAgICAgY29uZGl0aW9uOiBub3JtYWxpemVkID09PSAnbGVmdCcsXG4gICAgICAgICAgc3R5bGU6IHsgbWFyZ2luUmlnaHQ6IHRoZW1lLnNwYWNlMyB9LFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgY29uZGl0aW9uOiBhbGlnbm1lbnQgPT09ICdsZWZ0KycsXG4gICAgICAgICAgc3R5bGU6IHsgbWFyZ2luTGVmdDogLTc1IH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjb25kaXRpb246IG5vcm1hbGl6ZWQgPT09ICdyaWdodCcsXG4gICAgICAgICAgc3R5bGU6IHsgbWFyZ2luTGVmdDogdGhlbWUuc3BhY2UzIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjb25kaXRpb246IGFsaWdubWVudCA9PT0gJ3JpZ2h0KycsXG4gICAgICAgICAgc3R5bGU6IHsgbWFyZ2luUmlnaHQ6IC03NSB9LFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9O1xuICB9LFxuICBhY3Rpb25zOiBbXG4gICAge1xuICAgICAgdG9vbHRpcDogZ2V0RGF0YSA9PiBgQmlsZCAke2dldERhdGEoJ3ZhbHVlJykgPyAnd2VjaHNlbG4nIDogJ3fDpGhsZW4nfWAsXG4gICAgICBjb21wb25lbnQ6ICh7IHNldERhdGEsIGdldERhdGEsIC4uLnAgfSkgPT4gKFxuICAgICAgICA8RWRpdFRleHRcbiAgICAgICAgICBvbkNoYW5nZT17dmFsdWUgPT4gc2V0RGF0YSh7IHZhbHVlIH0pfVxuICAgICAgICAgIHZhbHVlPXtnZXREYXRhKCd2YWx1ZScsIHt9KX1cbiAgICAgICAgICBtdWx0aT17ZmFsc2V9XG4gICAgICAgIC8+XG4gICAgICApLFxuICAgICAgdG9nZ2xlOiAoKSA9PiB7fSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGxhYmVsOiA8RmFBbGlnbkxlZnQgLz4sXG4gICAgICB0b29sdGlwOiAnTGlua3MgYW5vcmRuZW4nLFxuICAgICAgYWN0aXZlOiAoeyBnZXREYXRhIH0pID0+IGdldERhdGEoJ2Zsb2F0JywgJ25vbmUnKS5pbmRleE9mKCdsZWZ0JykgPT09IDAsXG4gICAgICB0b2dnbGU6ICh7IHZhbHVlLCBvbkNoYW5nZSwgbm9kZSB9KSA9PiB7XG4gICAgICAgIGNvbnN0IGFsaWdubWVudCA9IG5vZGUuZGF0YS5nZXQoJ2Zsb2F0JykgfHwgJ25vbmUnO1xuICAgICAgICBpZiAoYWxpZ25tZW50ID09PSAnbm9uZScpIHtcbiAgICAgICAgICBvbkNoYW5nZShcbiAgICAgICAgICAgIHZhbHVlXG4gICAgICAgICAgICAgIC5jaGFuZ2UoKVxuICAgICAgICAgICAgICAucmVtb3ZlTm9kZUJ5S2V5KG5vZGUua2V5KVxuICAgICAgICAgICAgICAuY29sbGFwc2VUb1N0YXJ0T2ZOZXh0QmxvY2soKVxuICAgICAgICAgICAgICAuaW5zZXJ0SW5saW5lKFxuICAgICAgICAgICAgICAgIElubGluZS5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgdHlwZTogbm9kZS50eXBlLFxuICAgICAgICAgICAgICAgICAgaXNWb2lkOiBub2RlLmlzVm9pZCxcbiAgICAgICAgICAgICAgICAgIGRhdGE6IG5vZGUuZGF0YS5zZXQoJ2Zsb2F0JywgJ2xlZnQnKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKGFsaWdubWVudCA9PT0gJ2xlZnQnKSB7XG4gICAgICAgICAgb25DaGFuZ2UoXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgICAuY2hhbmdlKClcbiAgICAgICAgICAgICAgLnJlbW92ZU5vZGVCeUtleShub2RlLmtleSlcbiAgICAgICAgICAgICAgLmluc2VydElubGluZShcbiAgICAgICAgICAgICAgICBJbmxpbmUuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSxcbiAgICAgICAgICAgICAgICAgIGlzVm9pZDogbm9kZS5pc1ZvaWQsXG4gICAgICAgICAgICAgICAgICBkYXRhOiBub2RlLmRhdGEuc2V0KCdmbG9hdCcsICdsZWZ0KycpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb25DaGFuZ2UoXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgICAuY2hhbmdlKClcbiAgICAgICAgICAgICAgLnJlbW92ZU5vZGVCeUtleShub2RlLmtleSlcbiAgICAgICAgICAgICAgLmluc2VydEJsb2NrKFxuICAgICAgICAgICAgICAgIEJsb2NrLmNyZWF0ZSh7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBub2RlLnR5cGUsXG4gICAgICAgICAgICAgICAgICBpc1ZvaWQ6IG5vZGUuaXNWb2lkLFxuICAgICAgICAgICAgICAgICAgZGF0YTogbm9kZS5kYXRhLnNldCgnZmxvYXQnLCBudWxsKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgbGFiZWw6IDxGYUFsaWduUmlnaHQgLz4sXG4gICAgICB0b29sdGlwOiAnUmVjaHRzIGFub3JkbmVuJyxcbiAgICAgIGFjdGl2ZTogKHsgZ2V0RGF0YSB9KSA9PiBnZXREYXRhKCdmbG9hdCcsICdub25lJykuaW5kZXhPZigncmlnaHQnKSA9PT0gMCxcbiAgICAgIHRvZ2dsZTogKHsgdmFsdWUsIG9uQ2hhbmdlLCBub2RlIH0pID0+IHtcbiAgICAgICAgY29uc3QgYWxpZ25tZW50ID0gbm9kZS5kYXRhLmdldCgnZmxvYXQnKSB8fCAnbm9uZSc7XG5cbiAgICAgICAgaWYgKGFsaWdubWVudCA9PT0gJ25vbmUnKSB7XG4gICAgICAgICAgb25DaGFuZ2UoXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgICAuY2hhbmdlKClcbiAgICAgICAgICAgICAgLnJlbW92ZU5vZGVCeUtleShub2RlLmtleSlcbiAgICAgICAgICAgICAgLmluc2VydElubGluZShcbiAgICAgICAgICAgICAgICBJbmxpbmUuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSxcbiAgICAgICAgICAgICAgICAgIGlzVm9pZDogbm9kZS5pc1ZvaWQsXG4gICAgICAgICAgICAgICAgICBkYXRhOiBub2RlLmRhdGEuc2V0KCdmbG9hdCcsICdyaWdodCcpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAoYWxpZ25tZW50ID09PSAncmlnaHQnKSB7XG4gICAgICAgICAgb25DaGFuZ2UoXG4gICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgICAuY2hhbmdlKClcbiAgICAgICAgICAgICAgLnJlbW92ZU5vZGVCeUtleShub2RlLmtleSlcbiAgICAgICAgICAgICAgLmluc2VydElubGluZShcbiAgICAgICAgICAgICAgICBJbmxpbmUuY3JlYXRlKHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6IG5vZGUudHlwZSxcbiAgICAgICAgICAgICAgICAgIGlzVm9pZDogbm9kZS5pc1ZvaWQsXG4gICAgICAgICAgICAgICAgICBkYXRhOiBub2RlLmRhdGEuc2V0KCdmbG9hdCcsICdyaWdodCsnKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9uQ2hhbmdlKFxuICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgICAgLmNoYW5nZSgpXG4gICAgICAgICAgICAgIC5yZW1vdmVOb2RlQnlLZXkobm9kZS5rZXkpXG4gICAgICAgICAgICAgIC5pbnNlcnRCbG9jayhcbiAgICAgICAgICAgICAgICBCbG9jay5jcmVhdGUoe1xuICAgICAgICAgICAgICAgICAgdHlwZTogbm9kZS50eXBlLFxuICAgICAgICAgICAgICAgICAgaXNWb2lkOiBub2RlLmlzVm9pZCxcbiAgICAgICAgICAgICAgICAgIGRhdGE6IG5vZGUuZGF0YS5zZXQoJ2Zsb2F0JywgbnVsbCksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGxhYmVsOiA8RmFQbHVzIC8+LFxuICAgICAgdG9vbHRpcDogJ0dyw7bDn2VyJyxcbiAgICAgIHRvZ2dsZTogKHsgc2V0RGF0YSwgZ2V0RGF0YSB9KSA9PiB7XG4gICAgICAgIGNvbnN0IHNpemUgPSBnZXREYXRhKCdzaXplJywgNCk7XG4gICAgICAgIHNldERhdGEoe1xuICAgICAgICAgIHNpemU6IHNpemUgPiAxID8gc2l6ZSAtIDEgOiAxLFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICB7XG4gICAgICBsYWJlbDogPEZhTWludXMgLz4sXG4gICAgICB0b29sdGlwOiAnS2xlaW5lcicsXG4gICAgICB0b2dnbGU6ICh7IHNldERhdGEsIGdldERhdGEgfSkgPT4ge1xuICAgICAgICBjb25zdCBzaXplID0gZ2V0RGF0YSgnc2l6ZScsIDQpO1xuICAgICAgICBzZXREYXRhKHtcbiAgICAgICAgICBzaXplOiBzaXplIDwgOCA/IHNpemUgKyAxIDogOCxcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH0sXG4gIF0sXG59O1xuIl19
