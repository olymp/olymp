process.env.AUTH_SECRET = 'qokpw212';
process.env.TEST = true;
process.env.GCLOUD_PROJECT = 'admn-usc';
process.env.MAILS = true;

var express = require('express');
var app = express();
var bodyParser = require('body-parser');
app.use(bodyParser.urlencoded({ extended: false }));
app.use(bodyParser.json());

app.all('/auth/:method', function (req, res, next) {
  delete require.cache[require.resolve('powr-datastore')];
  delete require.cache[require.resolve('../lib/handler')];

  var DataStore = require('powr-datastore');
  var adapter = new DataStore({ project: process.env.GCLOUD_PROJECT });
  var auth = require('../lib/handler').auth({ adapter: adapter });
  auth({ method: req.params.method, payload: req.body }).then(function (x) {
    return res.json(x);
  }).catch(function (err) {
    return next(err);
  });
});

app.all(function (err, req, res, next) {
  res.status(500);
  res.render('error', { error: err });
});

app.listen(3000, function () {
  console.log('Auth app ready on 3000');
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2thZ2VzL2F1dGgvc2VydmVyL3Rlc3RzL3NlcnZlci5lczYiXSwibmFtZXMiOlsicHJvY2VzcyIsImVudiIsIkFVVEhfU0VDUkVUIiwiVEVTVCIsIkdDTE9VRF9QUk9KRUNUIiwiTUFJTFMiLCJleHByZXNzIiwicmVxdWlyZSIsImFwcCIsImJvZHlQYXJzZXIiLCJ1c2UiLCJ1cmxlbmNvZGVkIiwiZXh0ZW5kZWQiLCJqc29uIiwiYWxsIiwicmVxIiwicmVzIiwibmV4dCIsImNhY2hlIiwicmVzb2x2ZSIsIkRhdGFTdG9yZSIsImFkYXB0ZXIiLCJwcm9qZWN0IiwiYXV0aCIsIm1ldGhvZCIsInBhcmFtcyIsInBheWxvYWQiLCJib2R5IiwidGhlbiIsIngiLCJjYXRjaCIsImVyciIsInN0YXR1cyIsInJlbmRlciIsImVycm9yIiwibGlzdGVuIiwiY29uc29sZSIsImxvZyJdLCJtYXBwaW5ncyI6IkFBQUFBLFFBQVFDLEdBQVIsQ0FBWUMsV0FBWixHQUEwQixVQUExQjtBQUNBRixRQUFRQyxHQUFSLENBQVlFLElBQVosR0FBbUIsSUFBbkI7QUFDQUgsUUFBUUMsR0FBUixDQUFZRyxjQUFaLEdBQTZCLFVBQTdCO0FBQ0FKLFFBQVFDLEdBQVIsQ0FBWUksS0FBWixHQUFvQixJQUFwQjs7QUFFQSxJQUFNQyxVQUFVQyxRQUFRLFNBQVIsQ0FBaEI7QUFDQSxJQUFNQyxNQUFNRixTQUFaO0FBQ0EsSUFBTUcsYUFBYUYsUUFBUSxhQUFSLENBQW5CO0FBQ0FDLElBQUlFLEdBQUosQ0FBUUQsV0FBV0UsVUFBWCxDQUFzQixFQUFFQyxVQUFVLEtBQVosRUFBdEIsQ0FBUjtBQUNBSixJQUFJRSxHQUFKLENBQVFELFdBQVdJLElBQVgsRUFBUjs7QUFFQUwsSUFBSU0sR0FBSixDQUFRLGVBQVIsRUFBeUIsVUFBQ0MsR0FBRCxFQUFNQyxHQUFOLEVBQVdDLElBQVgsRUFBb0I7QUFDM0MsU0FBT1YsUUFBUVcsS0FBUixDQUFjWCxRQUFRWSxPQUFSLENBQWdCLGdCQUFoQixDQUFkLENBQVA7QUFDQSxTQUFPWixRQUFRVyxLQUFSLENBQWNYLFFBQVFZLE9BQVIsQ0FBZ0IsZ0JBQWhCLENBQWQsQ0FBUDs7QUFFQSxNQUFNQyxZQUFZYixRQUFRLGdCQUFSLENBQWxCO0FBQ0EsTUFBTWMsVUFBVSxJQUFJRCxTQUFKLENBQWMsRUFBRUUsU0FBU3RCLFFBQVFDLEdBQVIsQ0FBWUcsY0FBdkIsRUFBZCxDQUFoQjtBQUNBLE1BQU1tQixPQUFPaEIsUUFBUSxnQkFBUixFQUEwQmdCLElBQTFCLENBQStCLEVBQUVGLGdCQUFGLEVBQS9CLENBQWI7QUFDQUUsT0FBSyxFQUFFQyxRQUFRVCxJQUFJVSxNQUFKLENBQVdELE1BQXJCLEVBQTZCRSxTQUFTWCxJQUFJWSxJQUExQyxFQUFMLEVBQ0dDLElBREgsQ0FDUTtBQUFBLFdBQUtaLElBQUlILElBQUosQ0FBU2dCLENBQVQsQ0FBTDtBQUFBLEdBRFIsRUFFR0MsS0FGSCxDQUVTO0FBQUEsV0FBT2IsS0FBS2MsR0FBTCxDQUFQO0FBQUEsR0FGVDtBQUdELENBVkQ7O0FBWUF2QixJQUFJTSxHQUFKLENBQVEsVUFBQ2lCLEdBQUQsRUFBTWhCLEdBQU4sRUFBV0MsR0FBWCxFQUFnQkMsSUFBaEIsRUFBeUI7QUFDL0JELE1BQUlnQixNQUFKLENBQVcsR0FBWDtBQUNBaEIsTUFBSWlCLE1BQUosQ0FBVyxPQUFYLEVBQW9CLEVBQUVDLE9BQU9ILEdBQVQsRUFBcEI7QUFDRCxDQUhEOztBQUtBdkIsSUFBSTJCLE1BQUosQ0FBVyxJQUFYLEVBQWlCLFlBQU07QUFDckJDLFVBQVFDLEdBQVIsQ0FBWSx3QkFBWjtBQUNELENBRkQiLCJmaWxlIjoicGFja2FnZXMvYXV0aC9zZXJ2ZXIvdGVzdHMvc2VydmVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsicHJvY2Vzcy5lbnYuQVVUSF9TRUNSRVQgPSAncW9rcHcyMTInO1xucHJvY2Vzcy5lbnYuVEVTVCA9IHRydWU7XG5wcm9jZXNzLmVudi5HQ0xPVURfUFJPSkVDVCA9ICdhZG1uLXVzYyc7XG5wcm9jZXNzLmVudi5NQUlMUyA9IHRydWU7XG5cbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7XG5jb25zdCBhcHAgPSBleHByZXNzKCk7XG5jb25zdCBib2R5UGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKTtcbmFwcC51c2UoYm9keVBhcnNlci51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IGZhbHNlIH0pKTtcbmFwcC51c2UoYm9keVBhcnNlci5qc29uKCkpO1xuXG5hcHAuYWxsKCcvYXV0aC86bWV0aG9kJywgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gIGRlbGV0ZSByZXF1aXJlLmNhY2hlW3JlcXVpcmUucmVzb2x2ZSgncG93ci1kYXRhc3RvcmUnKV07XG4gIGRlbGV0ZSByZXF1aXJlLmNhY2hlW3JlcXVpcmUucmVzb2x2ZSgnLi4vbGliL2hhbmRsZXInKV07XG5cbiAgY29uc3QgRGF0YVN0b3JlID0gcmVxdWlyZSgncG93ci1kYXRhc3RvcmUnKTtcbiAgY29uc3QgYWRhcHRlciA9IG5ldyBEYXRhU3RvcmUoeyBwcm9qZWN0OiBwcm9jZXNzLmVudi5HQ0xPVURfUFJPSkVDVCB9KTtcbiAgY29uc3QgYXV0aCA9IHJlcXVpcmUoJy4uL2xpYi9oYW5kbGVyJykuYXV0aCh7IGFkYXB0ZXIgfSk7XG4gIGF1dGgoeyBtZXRob2Q6IHJlcS5wYXJhbXMubWV0aG9kLCBwYXlsb2FkOiByZXEuYm9keSB9KVxuICAgIC50aGVuKHggPT4gcmVzLmpzb24oeCkpXG4gICAgLmNhdGNoKGVyciA9PiBuZXh0KGVycikpO1xufSk7XG5cbmFwcC5hbGwoKGVyciwgcmVxLCByZXMsIG5leHQpID0+IHtcbiAgcmVzLnN0YXR1cyg1MDApO1xuICByZXMucmVuZGVyKCdlcnJvcicsIHsgZXJyb3I6IGVyciB9KTtcbn0pO1xuXG5hcHAubGlzdGVuKDMwMDAsICgpID0+IHtcbiAgY29uc29sZS5sb2coJ0F1dGggYXBwIHJlYWR5IG9uIDMwMDAnKTtcbn0pO1xuIl19
