import React from 'react';
import { render } from 'react-dom';
import { AmpProvider, UAProvider, UAParser } from 'olymp-utils';
import { ApolloProvider } from 'react-apollo';
import { ApolloClient, createBatchingNetworkInterface } from 'apollo-client';
import { AsyncComponentProvider, createAsyncContext, } from 'react-async-component';
import asyncBootstrapper from 'react-async-bootstrapper';
import { createFela } from 'olymp-fela';
import { Provider as FelaProvider } from 'react-fela';
import { GatewayProvider } from 'react-gateway';
import App from '@app';
import { AppContainer } from 'react-hot-loader';
import { createStore, combineReducers, applyMiddleware, compose } from 'redux';
import { BrowserRouter } from 'olymp-router';
import createHistory from 'history/createFlexHistory';
var init = require('@app').init;
if (process.env.NODE_ENV === 'production' && !process.env.IS_ELECTRON) {
    var offline_1 = require('offline-plugin/runtime');
    offline_1.install({
        onUpdating: function () {
            console.log('SW Event:', 'onUpdating');
        },
        onUpdateReady: function () {
            console.log('SW Event:', 'onUpdateReady');
            offline_1.applyUpdate();
        },
        onUpdated: function () {
            console.log('SW Event:', 'onUpdated');
        },
        onUpdateFailed: function () {
            console.log('SW Event:', 'onUpdateFailed');
        },
    });
}
else {
}
var networkInterface = createBatchingNetworkInterface({
    uri: process.env.GRAPHQL_URL ||
        (process.env.URL && process.env.URL + "/graphql") ||
        '/graphql',
    batchInterval: 5,
    opts: {
        credentials: 'same-origin',
    },
});
var client, mountNode, container, renderer, store, history, ua, rehydrateState, asyncContext;
function renderApp() {
    var app = (React.createElement(AsyncComponentProvider, { rehydrateState: rehydrateState, asyncContext: asyncContext },
        React.createElement(AppContainer, null,
            React.createElement(ApolloProvider, { store: store, client: client },
                React.createElement(BrowserRouter, { history: history },
                    React.createElement(FelaProvider, { renderer: renderer, mountNode: mountNode },
                        React.createElement(GatewayProvider, null,
                            React.createElement(UAProvider, { ua: ua },
                                React.createElement(AmpProvider, { amp: false },
                                    React.createElement(App, null))))))))));
    asyncBootstrapper(app).then(function () { return render(app, container); });
}
function load() {
    container = document.getElementById('app');
    mountNode = document.getElementById('css-markup');
    ua = new UAParser(window.navigator.userAgent);
    renderer = createFela(ua);
    client = new ApolloClient({
        networkInterface: networkInterface,
        dataIdFromObject: function (o) { return o.id; },
        ssrForceFetchDelay: 100,
    });
    history = createHistory();
    var composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;
    store = createStore(combineReducers({
        apollo: client.reducer(),
    }), window.INITIAL_DATA || {}, composeEnhancers(applyMiddleware(client.middleware())));
    rehydrateState = window.ASYNC_STATE;
    asyncContext = createAsyncContext();
    if (typeof init !== undefined && init) {
        init({ renderer: renderer, client: client, store: store });
    }
    return renderApp();
}
if (window.POLYFILLED) {
    load();
}
else {
    window.GO = load;
}
if (module.hot) {
    module.hot.accept('@app');
    module.hot.accept('@app', function () { return renderApp(require('@app').default); });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2thZ2VzL2NvcmUvd2ViL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDaEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUM5QyxPQUFPLEVBQUUsWUFBWSxFQUFFLDhCQUE4QixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFDTCxzQkFBc0IsRUFDdEIsa0JBQWtCLEdBQ25CLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxpQkFBaUIsTUFBTSwwQkFBMEIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxRQUFRLElBQUksWUFBWSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEQsT0FBTyxHQUFHLE1BQU0sTUFBTSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUloRCxPQUFPLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsT0FBTyxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDN0MsT0FBTyxhQUFhLE1BQU0sMkJBQTJCLENBQUM7QUFHdEQsSUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQztBQUVsQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxZQUFZLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFDdEUsSUFBTSxTQUFPLEdBQUcsT0FBTyxDQUFDLHdCQUF3QixDQUFDLENBQUM7SUFDbEQsU0FBTyxDQUFDLE9BQU8sQ0FBQztRQUNkLFVBQVUsRUFBRTtZQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ3pDLENBQUM7UUFDRCxhQUFhLEVBQUU7WUFDYixPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxlQUFlLENBQUMsQ0FBQztZQUMxQyxTQUFPLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDeEIsQ0FBQztRQUNELFNBQVMsRUFBRTtZQUNULE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBRXhDLENBQUM7UUFDRCxjQUFjLEVBQUU7WUFDZCxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzdDLENBQUM7S0FDRixDQUFDLENBQUM7QUFDTCxDQUFDO0FBQUMsSUFBSSxDQUFDLENBQUM7QUFHUixDQUFDO0FBY0QsSUFBTSxnQkFBZ0IsR0FBRyw4QkFBOEIsQ0FBQztJQUN0RCxHQUFHLEVBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXO1FBQ3ZCLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLGFBQVUsQ0FBQztRQUNqRCxVQUFVO0lBQ1osYUFBYSxFQUFFLENBQUM7SUFDaEIsSUFBSSxFQUFFO1FBQ0osV0FBVyxFQUFFLGFBQWE7S0FDM0I7Q0FDRixDQUFDLENBQUM7QUFZSCxJQUFJLE1BQU0sRUFDUixTQUFTLEVBQ1QsU0FBUyxFQUNULFFBQVEsRUFDUixLQUFLLEVBQ0wsT0FBTyxFQUNQLEVBQUUsRUFDRixjQUFjLEVBQ2QsWUFBWSxDQUFDO0FBQ2Y7SUFDRSxJQUFNLEdBQUcsR0FBRyxDQUNWLG9CQUFDLHNCQUFzQixJQUNyQixjQUFjLEVBQUUsY0FBYyxFQUM5QixZQUFZLEVBQUUsWUFBWTtRQUUxQixvQkFBQyxZQUFZO1lBQ1gsb0JBQUMsY0FBYyxJQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU07Z0JBQzFDLG9CQUFDLGFBQWEsSUFBQyxPQUFPLEVBQUUsT0FBTztvQkFDN0Isb0JBQUMsWUFBWSxJQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFNBQVM7d0JBQ3BELG9CQUFDLGVBQWU7NEJBQ2Qsb0JBQUMsVUFBVSxJQUFDLEVBQUUsRUFBRSxFQUFFO2dDQUNoQixvQkFBQyxXQUFXLElBQUMsR0FBRyxFQUFFLEtBQUs7b0NBQ3JCLG9CQUFDLEdBQUcsT0FBRyxDQUNLLENBQ0gsQ0FDRyxDQUNMLENBQ0QsQ0FDRCxDQUNKLENBQ1EsQ0FDMUIsQ0FBQztJQUNGLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFNLE9BQUEsTUFBTSxDQUFDLEdBQUcsRUFBRSxTQUFTLENBQUMsRUFBdEIsQ0FBc0IsQ0FBQyxDQUFDO0FBQzVELENBQUM7QUFDRDtJQUVFLFNBQVMsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzNDLFNBQVMsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQ2xELEVBQUUsR0FBRyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzlDLFFBQVEsR0FBRyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDMUIsTUFBTSxHQUFHLElBQUksWUFBWSxDQUFDO1FBQ3hCLGdCQUFnQixrQkFBQTtRQUNoQixnQkFBZ0IsRUFBRSxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsQ0FBQyxFQUFFLEVBQUosQ0FBSTtRQUMzQixrQkFBa0IsRUFBRSxHQUFHO0tBRXhCLENBQUMsQ0FBQztJQUVILE9BQU8sR0FBRyxhQUFhLEVBQUUsQ0FBQztJQUMxQixJQUFNLGdCQUFnQixHQUNwQixNQUFNLENBQUMsb0NBQW9DLElBQUksT0FBTyxDQUFDO0lBQ3pELEtBQUssR0FBRyxXQUFXLENBQ2pCLGVBQWUsQ0FBQztRQUNkLE1BQU0sRUFBRSxNQUFNLENBQUMsT0FBTyxFQUFFO0tBQ3pCLENBQUMsRUFDRixNQUFNLENBQUMsWUFBWSxJQUFJLEVBQUUsRUFDekIsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQ3ZELENBQUM7SUFFRixjQUFjLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztJQUNwQyxZQUFZLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQztJQUVwQyxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsRUFBRSxRQUFRLFVBQUEsRUFBRSxNQUFNLFFBQUEsRUFBRSxLQUFLLE9BQUEsRUFBRSxDQUFDLENBQUM7SUFDcEMsQ0FBQztJQUVELE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztBQUNyQixDQUFDO0FBR0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDdEIsSUFBSSxFQUFFLENBQUM7QUFDVCxDQUFDO0FBQUMsSUFBSSxDQUFDLENBQUM7SUFDTixNQUFNLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQztBQUNuQixDQUFDO0FBRUQsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFFZixNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUUxQixNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsY0FBTSxPQUFBLFNBQVMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQWxDLENBQWtDLENBQUMsQ0FBQztBQUN0RSxDQUFDIiwiZmlsZSI6InBhY2thZ2VzL2NvcmUvd2ViL2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHJlbmRlciB9IGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgeyBBbXBQcm92aWRlciwgVUFQcm92aWRlciwgVUFQYXJzZXIgfSBmcm9tICdvbHltcC11dGlscyc7XG5pbXBvcnQgeyBBcG9sbG9Qcm92aWRlciB9IGZyb20gJ3JlYWN0LWFwb2xsbyc7XG5pbXBvcnQgeyBBcG9sbG9DbGllbnQsIGNyZWF0ZUJhdGNoaW5nTmV0d29ya0ludGVyZmFjZSB9IGZyb20gJ2Fwb2xsby1jbGllbnQnO1xuaW1wb3J0IHtcbiAgQXN5bmNDb21wb25lbnRQcm92aWRlcixcbiAgY3JlYXRlQXN5bmNDb250ZXh0LFxufSBmcm9tICdyZWFjdC1hc3luYy1jb21wb25lbnQnO1xuaW1wb3J0IGFzeW5jQm9vdHN0cmFwcGVyIGZyb20gJ3JlYWN0LWFzeW5jLWJvb3RzdHJhcHBlcic7XG5pbXBvcnQgeyBjcmVhdGVGZWxhIH0gZnJvbSAnb2x5bXAtZmVsYSc7XG5pbXBvcnQgeyBQcm92aWRlciBhcyBGZWxhUHJvdmlkZXIgfSBmcm9tICdyZWFjdC1mZWxhJztcbmltcG9ydCB7IEdhdGV3YXlQcm92aWRlciB9IGZyb20gJ3JlYWN0LWdhdGV3YXknO1xuaW1wb3J0IEFwcCBmcm9tICdAYXBwJztcbmltcG9ydCB7IEFwcENvbnRhaW5lciB9IGZyb20gJ3JlYWN0LWhvdC1sb2FkZXInO1xuLy8gaW1wb3J0IHsgU3Vic2NyaXB0aW9uQ2xpZW50LCBhZGRHcmFwaFFMU3Vic2NyaXB0aW9ucyB9IGZyb20gJ3N1YnNjcmlwdGlvbnMtdHJhbnNwb3J0LXdzJztcblxuLy8gUmVkdXggc3R1ZmZcbmltcG9ydCB7IGNyZWF0ZVN0b3JlLCBjb21iaW5lUmVkdWNlcnMsIGFwcGx5TWlkZGxld2FyZSwgY29tcG9zZSB9IGZyb20gJ3JlZHV4JztcbmltcG9ydCB7IEJyb3dzZXJSb3V0ZXIgfSBmcm9tICdvbHltcC1yb3V0ZXInO1xuaW1wb3J0IGNyZWF0ZUhpc3RvcnkgZnJvbSAnaGlzdG9yeS9jcmVhdGVGbGV4SGlzdG9yeSc7XG4vLyBFbmQgUmVkdXggc3R1ZmZcblxuY29uc3QgaW5pdCA9IHJlcXVpcmUoJ0BhcHAnKS5pbml0O1xuLy8gd2luZG93LlBlcmYgPSByZXF1aXJlKCdyZWFjdC1hZGRvbnMtcGVyZicpO1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgJiYgIXByb2Nlc3MuZW52LklTX0VMRUNUUk9OKSB7XG4gIGNvbnN0IG9mZmxpbmUgPSByZXF1aXJlKCdvZmZsaW5lLXBsdWdpbi9ydW50aW1lJyk7XG4gIG9mZmxpbmUuaW5zdGFsbCh7XG4gICAgb25VcGRhdGluZzogKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1NXIEV2ZW50OicsICdvblVwZGF0aW5nJyk7XG4gICAgfSxcbiAgICBvblVwZGF0ZVJlYWR5OiAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnU1cgRXZlbnQ6JywgJ29uVXBkYXRlUmVhZHknKTtcbiAgICAgIG9mZmxpbmUuYXBwbHlVcGRhdGUoKTtcbiAgICB9LFxuICAgIG9uVXBkYXRlZDogKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1NXIEV2ZW50OicsICdvblVwZGF0ZWQnKTtcbiAgICAgIC8vIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsgLy8gT25seSBuZWVkZWQgd2l0aCBhdXRvVXBkYXRlc1xuICAgIH0sXG4gICAgb25VcGRhdGVGYWlsZWQ6ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdTVyBFdmVudDonLCAnb25VcGRhdGVGYWlsZWQnKTtcbiAgICB9LFxuICB9KTtcbn0gZWxzZSB7XG4gIC8vIGNvbnN0IHsgd2h5RGlkWW91VXBkYXRlIH0gPSByZXF1aXJlKCd3aHktZGlkLXlvdS11cGRhdGUnKTtcbiAgLy8gd2h5RGlkWW91VXBkYXRlKFJlYWN0KTtcbn1cbi8qIC8vIFRPRE9cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmdldFJlZ2lzdHJhdGlvbnMoKS50aGVuKChyZWdpc3RyYXRpb25zKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IHJlZ2lzdHJhdGlvbiBvZiByZWdpc3RyYXRpb25zKSB7XG4gICAgICAgIHJlZ2lzdHJhdGlvbi51bnJlZ2lzdGVyKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0gZWxzZSB7XG4gIGNvbnNvbGUud2Fybignd2ViL2luZGV4LmpzIHJlbW92ZXMgc2VydmljZXdvcmtlcnMgdGVtcG9yYXJpbHknKTtcbn0qL1xuXG5jb25zdCBuZXR3b3JrSW50ZXJmYWNlID0gY3JlYXRlQmF0Y2hpbmdOZXR3b3JrSW50ZXJmYWNlKHtcbiAgdXJpOlxuICAgIHByb2Nlc3MuZW52LkdSQVBIUUxfVVJMIHx8XG4gICAgKHByb2Nlc3MuZW52LlVSTCAmJiBgJHtwcm9jZXNzLmVudi5VUkx9L2dyYXBocWxgKSB8fFxuICAgICcvZ3JhcGhxbCcsXG4gIGJhdGNoSW50ZXJ2YWw6IDUsXG4gIG9wdHM6IHtcbiAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJyxcbiAgfSxcbn0pO1xuXG4vKiBpZiAocHJvY2Vzcy5lbnYuR1JBUEhRTF9TVUIpIHtcbiAgY29uc3Qgd3NDbGllbnQgPSBuZXcgU3Vic2NyaXB0aW9uQ2xpZW50KHByb2Nlc3MuZW52LkdSQVBIUUxfU1VCLCB7XG4gICAgcmVjb25uZWN0OiB0cnVlXG4gIH0pO1xuICBuZXR3b3JrSW50ZXJmYWNlID0gYWRkR3JhcGhRTFN1YnNjcmlwdGlvbnMoXG4gICAgbmV0d29ya0ludGVyZmFjZSxcbiAgICB3c0NsaWVudFxuICApO1xufSovXG5cbmxldCBjbGllbnQsXG4gIG1vdW50Tm9kZSxcbiAgY29udGFpbmVyLFxuICByZW5kZXJlcixcbiAgc3RvcmUsXG4gIGhpc3RvcnksXG4gIHVhLFxuICByZWh5ZHJhdGVTdGF0ZSxcbiAgYXN5bmNDb250ZXh0O1xuZnVuY3Rpb24gcmVuZGVyQXBwKCkge1xuICBjb25zdCBhcHAgPSAoXG4gICAgPEFzeW5jQ29tcG9uZW50UHJvdmlkZXJcbiAgICAgIHJlaHlkcmF0ZVN0YXRlPXtyZWh5ZHJhdGVTdGF0ZX1cbiAgICAgIGFzeW5jQ29udGV4dD17YXN5bmNDb250ZXh0fVxuICAgID5cbiAgICAgIDxBcHBDb250YWluZXI+XG4gICAgICAgIDxBcG9sbG9Qcm92aWRlciBzdG9yZT17c3RvcmV9IGNsaWVudD17Y2xpZW50fT5cbiAgICAgICAgICA8QnJvd3NlclJvdXRlciBoaXN0b3J5PXtoaXN0b3J5fT5cbiAgICAgICAgICAgIDxGZWxhUHJvdmlkZXIgcmVuZGVyZXI9e3JlbmRlcmVyfSBtb3VudE5vZGU9e21vdW50Tm9kZX0+XG4gICAgICAgICAgICAgIDxHYXRld2F5UHJvdmlkZXI+XG4gICAgICAgICAgICAgICAgPFVBUHJvdmlkZXIgdWE9e3VhfT5cbiAgICAgICAgICAgICAgICAgIDxBbXBQcm92aWRlciBhbXA9e2ZhbHNlfT5cbiAgICAgICAgICAgICAgICAgICAgPEFwcCAvPlxuICAgICAgICAgICAgICAgICAgPC9BbXBQcm92aWRlcj5cbiAgICAgICAgICAgICAgICA8L1VBUHJvdmlkZXI+XG4gICAgICAgICAgICAgIDwvR2F0ZXdheVByb3ZpZGVyPlxuICAgICAgICAgICAgPC9GZWxhUHJvdmlkZXI+XG4gICAgICAgICAgPC9Ccm93c2VyUm91dGVyPlxuICAgICAgICA8L0Fwb2xsb1Byb3ZpZGVyPlxuICAgICAgPC9BcHBDb250YWluZXI+XG4gICAgPC9Bc3luY0NvbXBvbmVudFByb3ZpZGVyPlxuICApO1xuICBhc3luY0Jvb3RzdHJhcHBlcihhcHApLnRoZW4oKCkgPT4gcmVuZGVyKGFwcCwgY29udGFpbmVyKSk7XG59XG5mdW5jdGlvbiBsb2FkKCkge1xuICAvLyBHZXQgdGhlIERPTSBFbGVtZW50IHRoYXQgd2lsbCBob3N0IG91ciBSZWFjdCBhcHBsaWNhdGlvbi5cbiAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcCcpO1xuICBtb3VudE5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3NzLW1hcmt1cCcpO1xuICB1YSA9IG5ldyBVQVBhcnNlcih3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XG4gIHJlbmRlcmVyID0gY3JlYXRlRmVsYSh1YSk7XG4gIGNsaWVudCA9IG5ldyBBcG9sbG9DbGllbnQoe1xuICAgIG5ldHdvcmtJbnRlcmZhY2UsXG4gICAgZGF0YUlkRnJvbU9iamVjdDogbyA9PiBvLmlkLFxuICAgIHNzckZvcmNlRmV0Y2hEZWxheTogMTAwLFxuICAgIC8vIGluaXRpYWxTdGF0ZTogd2luZG93LklOSVRJQUxfREFUQSxcbiAgfSk7XG4gIC8vIFJlZHV4IHN0dWZmXG4gIGhpc3RvcnkgPSBjcmVhdGVIaXN0b3J5KCk7XG4gIGNvbnN0IGNvbXBvc2VFbmhhbmNlcnMgPVxuICAgIHdpbmRvdy5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9DT01QT1NFX18gfHwgY29tcG9zZTtcbiAgc3RvcmUgPSBjcmVhdGVTdG9yZShcbiAgICBjb21iaW5lUmVkdWNlcnMoe1xuICAgICAgYXBvbGxvOiBjbGllbnQucmVkdWNlcigpLFxuICAgIH0pLFxuICAgIHdpbmRvdy5JTklUSUFMX0RBVEEgfHwge30sXG4gICAgY29tcG9zZUVuaGFuY2VycyhhcHBseU1pZGRsZXdhcmUoY2xpZW50Lm1pZGRsZXdhcmUoKSkpXG4gICk7XG4gIC8vIEVuZCBSZWR1eCBzdHVmZlxuICByZWh5ZHJhdGVTdGF0ZSA9IHdpbmRvdy5BU1lOQ19TVEFURTtcbiAgYXN5bmNDb250ZXh0ID0gY3JlYXRlQXN5bmNDb250ZXh0KCk7XG5cbiAgaWYgKHR5cGVvZiBpbml0ICE9PSB1bmRlZmluZWQgJiYgaW5pdCkge1xuICAgIGluaXQoeyByZW5kZXJlciwgY2xpZW50LCBzdG9yZSB9KTtcbiAgfVxuXG4gIHJldHVybiByZW5kZXJBcHAoKTtcbn1cblxuLy8gRXhlY3V0ZSB0aGUgZmlyc3QgcmVuZGVyIG9mIG91ciBhcHAuXG5pZiAod2luZG93LlBPTFlGSUxMRUQpIHtcbiAgbG9hZCgpO1xufSBlbHNlIHtcbiAgd2luZG93LkdPID0gbG9hZDtcbn1cblxuaWYgKG1vZHVsZS5ob3QpIHtcbiAgLy8gQWNjZXB0IGNoYW5nZXMgdG8gdGhpcyBmaWxlIGZvciBob3QgcmVsb2FkaW5nLlxuICBtb2R1bGUuaG90LmFjY2VwdCgnQGFwcCcpO1xuICAvLyBBbnkgY2hhbmdlcyB0byBvdXIgQXBwIHdpbGwgY2F1c2UgYSBob3Rsb2FkIHJlLXJlbmRlci5cbiAgbW9kdWxlLmhvdC5hY2NlcHQoJ0BhcHAnLCAoKSA9PiByZW5kZXJBcHAocmVxdWlyZSgnQGFwcCcpLmRlZmF1bHQpKTtcbn1cbiJdfQ==
