import React from 'react';
import { render } from 'react-dom';
import { AmpProvider, UAProvider, UAParser } from 'olymp-utils';
import { ApolloProvider } from 'react-apollo';
import { ApolloClient, createBatchingNetworkInterface } from 'apollo-client';
import { AsyncComponentProvider, createAsyncContext, } from 'react-async-component';
import asyncBootstrapper from 'react-async-bootstrapper';
import { createFela } from 'olymp-fela';
import { Provider as FelaProvider } from 'react-fela';
import { GatewayProvider } from 'react-gateway';
import App from '@app';
import { AppContainer } from 'react-hot-loader';
import { createStore, combineReducers, applyMiddleware, compose } from 'redux';
import { routerMiddleware, routerReducer } from 'olymp-router';
import { BrowserRouter } from 'olymp-router';
import createHistory from 'history/createFlexHistory';
var init = require('@app').init;
if (process.env.NODE_ENV === 'production' && !process.env.IS_ELECTRON) {
    var offline_1 = require('offline-plugin/runtime');
    offline_1.install({
        onUpdating: function () {
            console.log('SW Event:', 'onUpdating');
        },
        onUpdateReady: function () {
            console.log('SW Event:', 'onUpdateReady');
            offline_1.applyUpdate();
        },
        onUpdated: function () {
            console.log('SW Event:', 'onUpdated');
        },
        onUpdateFailed: function () {
            console.log('SW Event:', 'onUpdateFailed');
        },
    });
}
else {
}
var networkInterface = createBatchingNetworkInterface({
    uri: process.env.GRAPHQL_URL ||
        (process.env.URL && process.env.URL + "/graphql") ||
        '/graphql',
    batchInterval: 5,
    opts: {
        credentials: 'same-origin',
    },
});
var client, mountNode, container, renderer, store, ua, rehydrateState, history, asyncContext;
function renderApp() {
    var app = (React.createElement(AsyncComponentProvider, { rehydrateState: rehydrateState, asyncContext: asyncContext },
        React.createElement(AppContainer, null,
            React.createElement(ApolloProvider, { store: store, client: client },
                React.createElement(FelaProvider, { renderer: renderer, mountNode: mountNode },
                    React.createElement(GatewayProvider, null,
                        React.createElement(BrowserRouter, { history: history },
                            React.createElement(UAProvider, { ua: ua },
                                React.createElement(AmpProvider, { amp: false },
                                    React.createElement(App, null))))))))));
    asyncBootstrapper(app).then(function () { return render(app, container); });
}
function load() {
    container = document.getElementById('app');
    mountNode = document.getElementById('css-markup');
    ua = new UAParser(window.navigator.userAgent);
    renderer = createFela(ua);
    history = createHistory();
    client = new ApolloClient({
        networkInterface: networkInterface,
        dataIdFromObject: function (o) { return o.id; },
        ssrForceFetchDelay: 100,
    });
    store = createStore(combineReducers({
        apollo: client.reducer(),
        location: routerReducer(history),
    }), window.INITIAL_DATA || {}, compose(applyMiddleware(client.middleware()), applyMiddleware(routerMiddleware(history))));
    rehydrateState = window.ASYNC_STATE;
    asyncContext = createAsyncContext();
    if (typeof init !== undefined && init) {
        init({ renderer: renderer, client: client, store: store });
    }
    return renderApp();
}
if (window.POLYFILLED) {
    load();
}
else {
    window.GO = load;
}
if (module.hot) {
    module.hot.accept('@app');
    module.hot.accept('@app', function () { return renderApp(require('@app').default); });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2thZ2VzL2NvcmUvd2ViL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDaEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUM5QyxPQUFPLEVBQUUsWUFBWSxFQUFFLDhCQUE4QixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFDTCxzQkFBc0IsRUFDdEIsa0JBQWtCLEdBQ25CLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxpQkFBaUIsTUFBTSwwQkFBMEIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxRQUFRLElBQUksWUFBWSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3RELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEQsT0FBTyxHQUFHLE1BQU0sTUFBTSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUtoRCxPQUFPLEVBQUUsV0FBVyxFQUFFLGVBQWUsRUFBRSxlQUFlLEVBQUUsT0FBTyxFQUFFLE1BQU0sT0FBTyxDQUFDO0FBQy9FLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxhQUFhLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFJL0QsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUM3QyxPQUFPLGFBQWEsTUFBTSwyQkFBMkIsQ0FBQztBQUd0RCxJQUFNLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDO0FBRWxDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMs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QUMiLCJmaWxlIjoicGFja2FnZXMvY29yZS93ZWIvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgcmVuZGVyIH0gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCB7IEFtcFByb3ZpZGVyLCBVQVByb3ZpZGVyLCBVQVBhcnNlciB9IGZyb20gJ29seW1wLXV0aWxzJztcbmltcG9ydCB7IEFwb2xsb1Byb3ZpZGVyIH0gZnJvbSAncmVhY3QtYXBvbGxvJztcbmltcG9ydCB7IEFwb2xsb0NsaWVudCwgY3JlYXRlQmF0Y2hpbmdOZXR3b3JrSW50ZXJmYWNlIH0gZnJvbSAnYXBvbGxvLWNsaWVudCc7XG5pbXBvcnQge1xuICBBc3luY0NvbXBvbmVudFByb3ZpZGVyLFxuICBjcmVhdGVBc3luY0NvbnRleHQsXG59IGZyb20gJ3JlYWN0LWFzeW5jLWNvbXBvbmVudCc7XG5pbXBvcnQgYXN5bmNCb290c3RyYXBwZXIgZnJvbSAncmVhY3QtYXN5bmMtYm9vdHN0cmFwcGVyJztcbmltcG9ydCB7IGNyZWF0ZUZlbGEgfSBmcm9tICdvbHltcC1mZWxhJztcbmltcG9ydCB7IFByb3ZpZGVyIGFzIEZlbGFQcm92aWRlciB9IGZyb20gJ3JlYWN0LWZlbGEnO1xuaW1wb3J0IHsgR2F0ZXdheVByb3ZpZGVyIH0gZnJvbSAncmVhY3QtZ2F0ZXdheSc7XG5pbXBvcnQgQXBwIGZyb20gJ0BhcHAnO1xuaW1wb3J0IHsgQXBwQ29udGFpbmVyIH0gZnJvbSAncmVhY3QtaG90LWxvYWRlcic7XG5cbi8vIGltcG9ydCB7IFN1YnNjcmlwdGlvbkNsaWVudCwgYWRkR3JhcGhRTFN1YnNjcmlwdGlvbnMgfSBmcm9tICdzdWJzY3JpcHRpb25zLXRyYW5zcG9ydC13cyc7XG5cbi8vIFJlZHV4IHN0dWZmXG5pbXBvcnQgeyBjcmVhdGVTdG9yZSwgY29tYmluZVJlZHVjZXJzLCBhcHBseU1pZGRsZXdhcmUsIGNvbXBvc2UgfSBmcm9tICdyZWR1eCc7XG5pbXBvcnQgeyByb3V0ZXJNaWRkbGV3YXJlLCByb3V0ZXJSZWR1Y2VyIH0gZnJvbSAnb2x5bXAtcm91dGVyJztcbi8vIEVuZCBSZWR1eCBzdHVmZlxuXG4vLyBSZWFjdCByb3V0ZXJcbmltcG9ydCB7IEJyb3dzZXJSb3V0ZXIgfSBmcm9tICdvbHltcC1yb3V0ZXInO1xuaW1wb3J0IGNyZWF0ZUhpc3RvcnkgZnJvbSAnaGlzdG9yeS9jcmVhdGVGbGV4SGlzdG9yeSc7XG4vL1xuXG5jb25zdCBpbml0ID0gcmVxdWlyZSgnQGFwcCcpLmluaXQ7XG4vLyB3aW5kb3cuUGVyZiA9IHJlcXVpcmUoJ3JlYWN0LWFkZG9ucy1wZXJmJyk7XG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyAmJiAhcHJvY2Vzcy5lbnYuSVNfRUxFQ1RST04pIHtcbiAgY29uc3Qgb2ZmbGluZSA9IHJlcXVpcmUoJ29mZmxpbmUtcGx1Z2luL3J1bnRpbWUnKTtcbiAgb2ZmbGluZS5pbnN0YWxsKHtcbiAgICBvblVwZGF0aW5nOiAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnU1cgRXZlbnQ6JywgJ29uVXBkYXRpbmcnKTtcbiAgICB9LFxuICAgIG9uVXBkYXRlUmVhZHk6ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdTVyBFdmVudDonLCAnb25VcGRhdGVSZWFkeScpO1xuICAgICAgb2ZmbGluZS5hcHBseVVwZGF0ZSgpO1xuICAgIH0sXG4gICAgb25VcGRhdGVkOiAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnU1cgRXZlbnQ6JywgJ29uVXBkYXRlZCcpO1xuICAgICAgLy8gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpOyAvLyBPbmx5IG5lZWRlZCB3aXRoIGF1dG9VcGRhdGVzXG4gICAgfSxcbiAgICBvblVwZGF0ZUZhaWxlZDogKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1NXIEV2ZW50OicsICdvblVwZGF0ZUZhaWxlZCcpO1xuICAgIH0sXG4gIH0pO1xufSBlbHNlIHtcbiAgLy8gY29uc3QgeyB3aHlEaWRZb3VVcGRhdGUgfSA9IHJlcXVpcmUoJ3doeS1kaWQteW91LXVwZGF0ZScpO1xuICAvLyB3aHlEaWRZb3VVcGRhdGUoUmVhY3QpO1xufVxuLyogLy8gVE9ET1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuZ2V0UmVnaXN0cmF0aW9ucygpLnRoZW4oKHJlZ2lzdHJhdGlvbnMpID0+IHtcbiAgICAgIGZvciAoY29uc3QgcmVnaXN0cmF0aW9uIG9mIHJlZ2lzdHJhdGlvbnMpIHtcbiAgICAgICAgcmVnaXN0cmF0aW9uLnVucmVnaXN0ZXIoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSBlbHNlIHtcbiAgY29uc29sZS53YXJuKCd3ZWIvaW5kZXguanMgcmVtb3ZlcyBzZXJ2aWNld29ya2VycyB0ZW1wb3JhcmlseScpO1xufSovXG5cbmNvbnN0IG5ldHdvcmtJbnRlcmZhY2UgPSBjcmVhdGVCYXRjaGluZ05ldHdvcmtJbnRlcmZhY2Uoe1xuICB1cmk6XG4gICAgcHJvY2Vzcy5lbnYuR1JBUEhRTF9VUkwgfHxcbiAgICAocHJvY2Vzcy5lbnYuVVJMICYmIGAke3Byb2Nlc3MuZW52LlVSTH0vZ3JhcGhxbGApIHx8XG4gICAgJy9ncmFwaHFsJyxcbiAgYmF0Y2hJbnRlcnZhbDogNSxcbiAgb3B0czoge1xuICAgIGNyZWRlbnRpYWxzOiAnc2FtZS1vcmlnaW4nLFxuICB9LFxufSk7XG5cbi8qIGlmIChwcm9jZXNzLmVudi5HUkFQSFFMX1NVQikge1xuICBjb25zdCB3c0NsaWVudCA9IG5ldyBTdWJzY3JpcHRpb25DbGllbnQocHJvY2Vzcy5lbnYuR1JBUEhRTF9TVUIsIHtcbiAgICByZWNvbm5lY3Q6IHRydWVcbiAgfSk7XG4gIG5ldHdvcmtJbnRlcmZhY2UgPSBhZGRHcmFwaFFMU3Vic2NyaXB0aW9ucyhcbiAgICBuZXR3b3JrSW50ZXJmYWNlLFxuICAgIHdzQ2xpZW50XG4gICk7XG59Ki9cblxubGV0IGNsaWVudCxcbiAgbW91bnROb2RlLFxuICBjb250YWluZXIsXG4gIHJlbmRlcmVyLFxuICBzdG9yZSxcbiAgdWEsXG4gIHJlaHlkcmF0ZVN0YXRlLFxuICBoaXN0b3J5LFxuICBhc3luY0NvbnRleHQ7XG5mdW5jdGlvbiByZW5kZXJBcHAoKSB7XG4gIGNvbnN0IGFwcCA9IChcbiAgICA8QXN5bmNDb21wb25lbnRQcm92aWRlclxuICAgICAgcmVoeWRyYXRlU3RhdGU9e3JlaHlkcmF0ZVN0YXRlfVxuICAgICAgYXN5bmNDb250ZXh0PXthc3luY0NvbnRleHR9XG4gICAgPlxuICAgICAgPEFwcENvbnRhaW5lcj5cbiAgICAgICAgPEFwb2xsb1Byb3ZpZGVyIHN0b3JlPXtzdG9yZX0gY2xpZW50PXtjbGllbnR9PlxuICAgICAgICAgIDxGZWxhUHJvdmlkZXIgcmVuZGVyZXI9e3JlbmRlcmVyfSBtb3VudE5vZGU9e21vdW50Tm9kZX0+XG4gICAgICAgICAgICA8R2F0ZXdheVByb3ZpZGVyPlxuICAgICAgICAgICAgICA8QnJvd3NlclJvdXRlciBoaXN0b3J5PXtoaXN0b3J5fT5cbiAgICAgICAgICAgICAgICA8VUFQcm92aWRlciB1YT17dWF9PlxuICAgICAgICAgICAgICAgICAgPEFtcFByb3ZpZGVyIGFtcD17ZmFsc2V9PlxuICAgICAgICAgICAgICAgICAgICA8QXBwIC8+XG4gICAgICAgICAgICAgICAgICA8L0FtcFByb3ZpZGVyPlxuICAgICAgICAgICAgICAgIDwvVUFQcm92aWRlcj5cbiAgICAgICAgICAgICAgPC9Ccm93c2VyUm91dGVyPlxuICAgICAgICAgICAgPC9HYXRld2F5UHJvdmlkZXI+XG4gICAgICAgICAgPC9GZWxhUHJvdmlkZXI+XG4gICAgICAgIDwvQXBvbGxvUHJvdmlkZXI+XG4gICAgICA8L0FwcENvbnRhaW5lcj5cbiAgICA8L0FzeW5jQ29tcG9uZW50UHJvdmlkZXI+XG4gICk7XG4gIGFzeW5jQm9vdHN0cmFwcGVyKGFwcCkudGhlbigoKSA9PiByZW5kZXIoYXBwLCBjb250YWluZXIpKTtcbn1cbmZ1bmN0aW9uIGxvYWQoKSB7XG4gIC8vIEdldCB0aGUgRE9NIEVsZW1lbnQgdGhhdCB3aWxsIGhvc3Qgb3VyIFJlYWN0IGFwcGxpY2F0aW9uLlxuICBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXBwJyk7XG4gIG1vdW50Tm9kZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjc3MtbWFya3VwJyk7XG4gIHVhID0gbmV3IFVBUGFyc2VyKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcbiAgcmVuZGVyZXIgPSBjcmVhdGVGZWxhKHVhKTtcbiAgaGlzdG9yeSA9IGNyZWF0ZUhpc3RvcnkoKTtcbiAgY2xpZW50ID0gbmV3IEFwb2xsb0NsaWVudCh7XG4gICAgbmV0d29ya0ludGVyZmFjZSxcbiAgICBkYXRhSWRGcm9tT2JqZWN0OiBvID0+IG8uaWQsXG4gICAgc3NyRm9yY2VGZXRjaERlbGF5OiAxMDAsXG4gICAgLy8gaW5pdGlhbFN0YXRlOiB3aW5kb3cuSU5JVElBTF9EQVRBLFxuICB9KTtcbiAgLy8gUmVkdXggc3R1ZmZcbiAgLy8gY29uc3QgY29tcG9zZUVuaGFuY2VycyA9IHdpbmRvdy5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9DT01QT1NFX18gfHwgY29tcG9zZTtcbiAgc3RvcmUgPSBjcmVhdGVTdG9yZShcbiAgICBjb21iaW5lUmVkdWNlcnMoe1xuICAgICAgYXBvbGxvOiBjbGllbnQucmVkdWNlcigpLFxuICAgICAgbG9jYXRpb246IHJvdXRlclJlZHVjZXIoaGlzdG9yeSksXG4gICAgfSksXG4gICAgd2luZG93LklOSVRJQUxfREFUQSB8fCB7fSxcbiAgICBjb21wb3NlKFxuICAgICAgYXBwbHlNaWRkbGV3YXJlKGNsaWVudC5taWRkbGV3YXJlKCkpLFxuICAgICAgYXBwbHlNaWRkbGV3YXJlKHJvdXRlck1pZGRsZXdhcmUoaGlzdG9yeSkpXG4gICAgKVxuICApO1xuICAvLyBFbmQgUmVkdXggc3R1ZmZcbiAgcmVoeWRyYXRlU3RhdGUgPSB3aW5kb3cuQVNZTkNfU1RBVEU7XG4gIGFzeW5jQ29udGV4dCA9IGNyZWF0ZUFzeW5jQ29udGV4dCgpO1xuXG4gIGlmICh0eXBlb2YgaW5pdCAhPT0gdW5kZWZpbmVkICYmIGluaXQpIHtcbiAgICBpbml0KHsgcmVuZGVyZXIsIGNsaWVudCwgc3RvcmUgfSk7XG4gIH1cblxuICByZXR1cm4gcmVuZGVyQXBwKCk7XG59XG5cbi8vIEV4ZWN1dGUgdGhlIGZpcnN0IHJlbmRlciBvZiBvdXIgYXBwLlxuaWYgKHdpbmRvdy5QT0xZRklMTEVEKSB7XG4gIGxvYWQoKTtcbn0gZWxzZSB7XG4gIHdpbmRvdy5HTyA9IGxvYWQ7XG59XG5cbmlmIChtb2R1bGUuaG90KSB7XG4gIC8vIEFjY2VwdCBjaGFuZ2VzIHRvIHRoaXMgZmlsZSBmb3IgaG90IHJlbG9hZGluZy5cbiAgbW9kdWxlLmhvdC5hY2NlcHQoJ0BhcHAnKTtcbiAgLy8gQW55IGNoYW5nZXMgdG8gb3VyIEFwcCB3aWxsIGNhdXNlIGEgaG90bG9hZCByZS1yZW5kZXIuXG4gIG1vZHVsZS5ob3QuYWNjZXB0KCdAYXBwJywgKCkgPT4gcmVuZGVyQXBwKHJlcXVpcmUoJ0BhcHAnKS5kZWZhdWx0KSk7XG59XG4iXX0=
