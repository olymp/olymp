import React from 'react';
import { render } from 'react-dom';
import { AmpProvider, UAProvider, UAParser } from 'olymp-utils';
import { ApolloProvider } from 'react-apollo';
import { ApolloClient, createBatchingNetworkInterface } from 'apollo-client';
import { AsyncComponentProvider, createAsyncContext, } from 'react-async-component';
import asyncBootstrapper from 'react-async-bootstrapper';
import { createFela, felaReducer } from 'olymp-fela';
import { Provider as FelaProvider } from 'react-fela';
import { GatewayProvider } from 'react-gateway';
import App from '@app';
import { AppContainer } from 'react-hot-loader';
import { createStore, combineReducers, applyMiddleware, compose } from 'redux';
import { routerMiddleware, routerReducer } from 'olymp-router';
import { BrowserRouter, createHistory } from 'olymp-router';
var init = require('@app').init;
if (process.env.NODE_ENV === 'production' && !process.env.IS_ELECTRON) {
    var offline_1 = require('offline-plugin/runtime');
    offline_1.install({
        onUpdating: function () {
            console.log('SW Event:', 'onUpdating');
        },
        onUpdateReady: function () {
            console.log('SW Event:', 'onUpdateReady');
            offline_1.applyUpdate();
        },
        onUpdated: function () {
            console.log('SW Event:', 'onUpdated');
        },
        onUpdateFailed: function () {
            console.log('SW Event:', 'onUpdateFailed');
        },
    });
}
else {
}
var networkInterface = createBatchingNetworkInterface({
    uri: process.env.GRAPHQL_URL ||
        (process.env.URL && process.env.URL + "/graphql") ||
        '/graphql',
    batchInterval: 5,
    opts: {
        credentials: 'same-origin',
    },
});
var client, mountNode, container, renderer, store, ua, rehydrateState, history, asyncContext;
function renderApp() {
    var app = (React.createElement(AsyncComponentProvider, { rehydrateState: rehydrateState, asyncContext: asyncContext },
        React.createElement(AppContainer, null,
            React.createElement(ApolloProvider, { store: store, client: client },
                React.createElement(FelaProvider, { renderer: renderer, mountNode: mountNode },
                    React.createElement(GatewayProvider, null,
                        React.createElement(BrowserRouter, { history: history },
                            React.createElement(UAProvider, { ua: ua },
                                React.createElement(AmpProvider, { amp: false },
                                    React.createElement(App, null))))))))));
    asyncBootstrapper(app).then(function () { return render(app, container); });
}
function load() {
    container = document.getElementById('app');
    mountNode = document.getElementById('css-markup');
    ua = new UAParser(window.navigator.userAgent);
    renderer = createFela(ua);
    history = createHistory();
    client = new ApolloClient({
        networkInterface: networkInterface,
        dataIdFromObject: function (o) { return o.id; },
        ssrForceFetchDelay: 100,
    });
    store = createStore(combineReducers({
        apollo: client.reducer(),
        location: routerReducer(history),
        fela: felaReducer,
    }), window.INITIAL_DATA || {}, compose(applyMiddleware(client.middleware()), applyMiddleware(routerMiddleware(history))));
    rehydrateState = window.ASYNC_STATE;
    asyncContext = createAsyncContext();
    if (typeof init !== undefined && init) {
        init({ renderer: renderer, client: client, store: store });
    }
    return renderApp();
}
if (window.POLYFILLED) {
    load();
}
else {
    window.GO = load;
}
if (module.hot) {
    module.hot.accept('@app');
    module.hot.accept('@app', function () { return renderApp(require('@app').default); });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2thZ2VzL2NvcmUvd2ViL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDaEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUM5QyxPQUFPLEVBQUUsWUFBWSxFQUFFLDhCQUE4QixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFDTCxzQkFBc0IsRUFDdEIsa0JBQWtCLEdBQ25CLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxpQkFBaUIsTUFBTSwwQkFBMEIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUNyRCxPQUFPLEVBQUUsUUFBUSxJQUFJLFlBQVksRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hELE9BQU8sR0FBRyxNQUFNLE1BQU0sQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFLaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUMvRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsYUFBYSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBSS9ELE9BQU8sRUFBRSxhQUFhLEVBQUUsYUFBYSxFQUFFLE1BQU0sY0FBYyxDQUFDO0FBRzVELElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFFbEMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssWUFB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QUFDdEUsQ0FBQyIsImZpbGUiOiJwYWNrYWdlcy9jb3JlL3dlYi9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyByZW5kZXIgfSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IHsgQW1wUHJvdmlkZXIsIFVBUHJvdmlkZXIsIFVBUGFyc2VyIH0gZnJvbSAnb2x5bXAtdXRpbHMnO1xuaW1wb3J0IHsgQXBvbGxvUHJvdmlkZXIgfSBmcm9tICdyZWFjdC1hcG9sbG8nO1xuaW1wb3J0IHsgQXBvbGxvQ2xpZW50LCBjcmVhdGVCYXRjaGluZ05ldHdvcmtJbnRlcmZhY2UgfSBmcm9tICdhcG9sbG8tY2xpZW50JztcbmltcG9ydCB7XG4gIEFzeW5jQ29tcG9uZW50UHJvdmlkZXIsXG4gIGNyZWF0ZUFzeW5jQ29udGV4dCxcbn0gZnJvbSAncmVhY3QtYXN5bmMtY29tcG9uZW50JztcbmltcG9ydCBhc3luY0Jvb3RzdHJhcHBlciBmcm9tICdyZWFjdC1hc3luYy1ib290c3RyYXBwZXInO1xuaW1wb3J0IHsgY3JlYXRlRmVsYSwgZmVsYVJlZHVjZXIgfSBmcm9tICdvbHltcC1mZWxhJztcbmltcG9ydCB7IFByb3ZpZGVyIGFzIEZlbGFQcm92aWRlciB9IGZyb20gJ3JlYWN0LWZlbGEnO1xuaW1wb3J0IHsgR2F0ZXdheVByb3ZpZGVyIH0gZnJvbSAncmVhY3QtZ2F0ZXdheSc7XG5pbXBvcnQgQXBwIGZyb20gJ0BhcHAnO1xuaW1wb3J0IHsgQXBwQ29udGFpbmVyIH0gZnJvbSAncmVhY3QtaG90LWxvYWRlcic7XG5cbi8vIGltcG9ydCB7IFN1YnNjcmlwdGlvbkNsaWVudCwgYWRkR3JhcGhRTFN1YnNjcmlwdGlvbnMgfSBmcm9tICdzdWJzY3JpcHRpb25zLXRyYW5zcG9ydC13cyc7XG5cbi8vIFJlZHV4IHN0dWZmXG5pbXBvcnQgeyBjcmVhdGVTdG9yZSwgY29tYmluZVJlZHVjZXJzLCBhcHBseU1pZGRsZXdhcmUsIGNvbXBvc2UgfSBmcm9tICdyZWR1eCc7XG5pbXBvcnQgeyByb3V0ZXJNaWRkbGV3YXJlLCByb3V0ZXJSZWR1Y2VyIH0gZnJvbSAnb2x5bXAtcm91dGVyJztcbi8vIEVuZCBSZWR1eCBzdHVmZlxuXG4vLyBSZWFjdCByb3V0ZXJcbmltcG9ydCB7IEJyb3dzZXJSb3V0ZXIsIGNyZWF0ZUhpc3RvcnkgfSBmcm9tICdvbHltcC1yb3V0ZXInO1xuLy9cblxuY29uc3QgaW5pdCA9IHJlcXVpcmUoJ0BhcHAnKS5pbml0O1xuLy8gd2luZG93LlBlcmYgPSByZXF1aXJlKCdyZWFjdC1hZGRvbnMtcGVyZicpO1xuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgJiYgIXByb2Nlc3MuZW52LklTX0VMRUNUUk9OKSB7XG4gIGNvbnN0IG9mZmxpbmUgPSByZXF1aXJlKCdvZmZsaW5lLXBsdWdpbi9ydW50aW1lJyk7XG4gIG9mZmxpbmUuaW5zdGFsbCh7XG4gICAgb25VcGRhdGluZzogKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1NXIEV2ZW50OicsICdvblVwZGF0aW5nJyk7XG4gICAgfSxcbiAgICBvblVwZGF0ZVJlYWR5OiAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnU1cgRXZlbnQ6JywgJ29uVXBkYXRlUmVhZHknKTtcbiAgICAgIG9mZmxpbmUuYXBwbHlVcGRhdGUoKTtcbiAgICB9LFxuICAgIG9uVXBkYXRlZDogKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1NXIEV2ZW50OicsICdvblVwZGF0ZWQnKTtcbiAgICAgIC8vIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTsgLy8gT25seSBuZWVkZWQgd2l0aCBhdXRvVXBkYXRlc1xuICAgIH0sXG4gICAgb25VcGRhdGVGYWlsZWQ6ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdTVyBFdmVudDonLCAnb25VcGRhdGVGYWlsZWQnKTtcbiAgICB9LFxuICB9KTtcbn0gZWxzZSB7XG4gIC8vIGNvbnN0IHsgd2h5RGlkWW91VXBkYXRlIH0gPSByZXF1aXJlKCd3aHktZGlkLXlvdS11cGRhdGUnKTtcbiAgLy8gd2h5RGlkWW91VXBkYXRlKFJlYWN0KTtcbn1cbi8qIC8vIFRPRE9cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSAndW5kZWZpbmVkJyAmJiBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmdldFJlZ2lzdHJhdGlvbnMoKS50aGVuKChyZWdpc3RyYXRpb25zKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IHJlZ2lzdHJhdGlvbiBvZiByZWdpc3RyYXRpb25zKSB7XG4gICAgICAgIHJlZ2lzdHJhdGlvbi51bnJlZ2lzdGVyKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0gZWxzZSB7XG4gIGNvbnNvbGUud2Fybignd2ViL2luZGV4LmpzIHJlbW92ZXMgc2VydmljZXdvcmtlcnMgdGVtcG9yYXJpbHknKTtcbn0qL1xuXG5jb25zdCBuZXR3b3JrSW50ZXJmYWNlID0gY3JlYXRlQmF0Y2hpbmdOZXR3b3JrSW50ZXJmYWNlKHtcbiAgdXJpOlxuICAgIHByb2Nlc3MuZW52LkdSQVBIUUxfVVJMIHx8XG4gICAgKHByb2Nlc3MuZW52LlVSTCAmJiBgJHtwcm9jZXNzLmVudi5VUkx9L2dyYXBocWxgKSB8fFxuICAgICcvZ3JhcGhxbCcsXG4gIGJhdGNoSW50ZXJ2YWw6IDUsXG4gIG9wdHM6IHtcbiAgICBjcmVkZW50aWFsczogJ3NhbWUtb3JpZ2luJyxcbiAgfSxcbn0pO1xuXG4vKiBpZiAocHJvY2Vzcy5lbnYuR1JBUEhRTF9TVUIpIHtcbiAgY29uc3Qgd3NDbGllbnQgPSBuZXcgU3Vic2NyaXB0aW9uQ2xpZW50KHByb2Nlc3MuZW52LkdSQVBIUUxfU1VCLCB7XG4gICAgcmVjb25uZWN0OiB0cnVlXG4gIH0pO1xuICBuZXR3b3JrSW50ZXJmYWNlID0gYWRkR3JhcGhRTFN1YnNjcmlwdGlvbnMoXG4gICAgbmV0d29ya0ludGVyZmFjZSxcbiAgICB3c0NsaWVudFxuICApO1xufSovXG5cbmxldCBjbGllbnQsXG4gIG1vdW50Tm9kZSxcbiAgY29udGFpbmVyLFxuICByZW5kZXJlcixcbiAgc3RvcmUsXG4gIHVhLFxuICByZWh5ZHJhdGVTdGF0ZSxcbiAgaGlzdG9yeSxcbiAgYXN5bmNDb250ZXh0O1xuZnVuY3Rpb24gcmVuZGVyQXBwKCkge1xuICBjb25zdCBhcHAgPSAoXG4gICAgPEFzeW5jQ29tcG9uZW50UHJvdmlkZXJcbiAgICAgIHJlaHlkcmF0ZVN0YXRlPXtyZWh5ZHJhdGVTdGF0ZX1cbiAgICAgIGFzeW5jQ29udGV4dD17YXN5bmNDb250ZXh0fVxuICAgID5cbiAgICAgIDxBcHBDb250YWluZXI+XG4gICAgICAgIDxBcG9sbG9Qcm92aWRlciBzdG9yZT17c3RvcmV9IGNsaWVudD17Y2xpZW50fT5cbiAgICAgICAgICA8RmVsYVByb3ZpZGVyIHJlbmRlcmVyPXtyZW5kZXJlcn0gbW91bnROb2RlPXttb3VudE5vZGV9PlxuICAgICAgICAgICAgPEdhdGV3YXlQcm92aWRlcj5cbiAgICAgICAgICAgICAgPEJyb3dzZXJSb3V0ZXIgaGlzdG9yeT17aGlzdG9yeX0+XG4gICAgICAgICAgICAgICAgPFVBUHJvdmlkZXIgdWE9e3VhfT5cbiAgICAgICAgICAgICAgICAgIDxBbXBQcm92aWRlciBhbXA9e2ZhbHNlfT5cbiAgICAgICAgICAgICAgICAgICAgPEFwcCAvPlxuICAgICAgICAgICAgICAgICAgPC9BbXBQcm92aWRlcj5cbiAgICAgICAgICAgICAgICA8L1VBUHJvdmlkZXI+XG4gICAgICAgICAgICAgIDwvQnJvd3NlclJvdXRlcj5cbiAgICAgICAgICAgIDwvR2F0ZXdheVByb3ZpZGVyPlxuICAgICAgICAgIDwvRmVsYVByb3ZpZGVyPlxuICAgICAgICA8L0Fwb2xsb1Byb3ZpZGVyPlxuICAgICAgPC9BcHBDb250YWluZXI+XG4gICAgPC9Bc3luY0NvbXBvbmVudFByb3ZpZGVyPlxuICApO1xuICBhc3luY0Jvb3RzdHJhcHBlcihhcHApLnRoZW4oKCkgPT4gcmVuZGVyKGFwcCwgY29udGFpbmVyKSk7XG59XG5mdW5jdGlvbiBsb2FkKCkge1xuICAvLyBHZXQgdGhlIERPTSBFbGVtZW50IHRoYXQgd2lsbCBob3N0IG91ciBSZWFjdCBhcHBsaWNhdGlvbi5cbiAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcCcpO1xuICBtb3VudE5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3NzLW1hcmt1cCcpO1xuICB1YSA9IG5ldyBVQVBhcnNlcih3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XG4gIHJlbmRlcmVyID0gY3JlYXRlRmVsYSh1YSk7XG4gIGhpc3RvcnkgPSBjcmVhdGVIaXN0b3J5KCk7XG4gIGNsaWVudCA9IG5ldyBBcG9sbG9DbGllbnQoe1xuICAgIG5ldHdvcmtJbnRlcmZhY2UsXG4gICAgZGF0YUlkRnJvbU9iamVjdDogbyA9PiBvLmlkLFxuICAgIHNzckZvcmNlRmV0Y2hEZWxheTogMTAwLFxuICAgIC8vIGluaXRpYWxTdGF0ZTogd2luZG93LklOSVRJQUxfREFUQSxcbiAgfSk7XG4gIC8vIFJlZHV4IHN0dWZmXG4gIC8vIGNvbnN0IGNvbXBvc2VFbmhhbmNlcnMgPSB3aW5kb3cuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fQ09NUE9TRV9fIHx8IGNvbXBvc2U7XG4gIHN0b3JlID0gY3JlYXRlU3RvcmUoXG4gICAgY29tYmluZVJlZHVjZXJzKHtcbiAgICAgIGFwb2xsbzogY2xpZW50LnJlZHVjZXIoKSxcbiAgICAgIGxvY2F0aW9uOiByb3V0ZXJSZWR1Y2VyKGhpc3RvcnkpLFxuICAgICAgZmVsYTogZmVsYVJlZHVjZXIsXG4gICAgfSksXG4gICAgd2luZG93LklOSVRJQUxfREFUQSB8fCB7fSxcbiAgICBjb21wb3NlKFxuICAgICAgYXBwbHlNaWRkbGV3YXJlKGNsaWVudC5taWRkbGV3YXJlKCkpLFxuICAgICAgYXBwbHlNaWRkbGV3YXJlKHJvdXRlck1pZGRsZXdhcmUoaGlzdG9yeSkpXG4gICAgKVxuICApO1xuICAvLyBFbmQgUmVkdXggc3R1ZmZcbiAgcmVoeWRyYXRlU3RhdGUgPSB3aW5kb3cuQVNZTkNfU1RBVEU7XG4gIGFzeW5jQ29udGV4dCA9IGNyZWF0ZUFzeW5jQ29udGV4dCgpO1xuXG4gIGlmICh0eXBlb2YgaW5pdCAhPT0gdW5kZWZpbmVkICYmIGluaXQpIHtcbiAgICBpbml0KHsgcmVuZGVyZXIsIGNsaWVudCwgc3RvcmUgfSk7XG4gIH1cblxuICByZXR1cm4gcmVuZGVyQXBwKCk7XG59XG5cbi8vIEV4ZWN1dGUgdGhlIGZpcnN0IHJlbmRlciBvZiBvdXIgYXBwLlxuaWYgKHdpbmRvdy5QT0xZRklMTEVEKSB7XG4gIGxvYWQoKTtcbn0gZWxzZSB7XG4gIHdpbmRvdy5HTyA9IGxvYWQ7XG59XG5cbmlmIChtb2R1bGUuaG90KSB7XG4gIC8vIEFjY2VwdCBjaGFuZ2VzIHRvIHRoaXMgZmlsZSBmb3IgaG90IHJlbG9hZGluZy5cbiAgbW9kdWxlLmhvdC5hY2NlcHQoJ0BhcHAnKTtcbiAgLy8gQW55IGNoYW5nZXMgdG8gb3VyIEFwcCB3aWxsIGNhdXNlIGEgaG90bG9hZCByZS1yZW5kZXIuXG4gIG1vZHVsZS5ob3QuYWNjZXB0KCdAYXBwJywgKCkgPT4gcmVuZGVyQXBwKHJlcXVpcmUoJ0BhcHAnKS5kZWZhdWx0KSk7XG59XG4iXX0=
