import React from 'react';
import { render } from 'react-dom';
import { AmpProvider, UAProvider, UAParser } from 'olymp-utils';
import { ApolloProvider } from 'react-apollo';
import { ApolloClient, createBatchingNetworkInterface } from 'apollo-client';
import { AsyncComponentProvider, createAsyncContext, } from 'react-async-component';
import asyncBootstrapper from 'react-async-bootstrapper';
import { createFela, felaReducer } from 'olymp-fela';
import { Provider as FelaProvider } from 'react-fela';
import { GatewayProvider } from 'react-gateway';
import App from '@app';
import { AppContainer } from 'react-hot-loader';
import { createStore, combineReducers, applyMiddleware, compose } from 'redux';
import { createHistory, attachHistory, routerMiddleware, routerReducer, } from 'olymp-router';
var init = require('@app').init;
if (process.env.NODE_ENV === 'production' && !process.env.IS_ELECTRON) {
    var offline_1 = require('offline-plugin/runtime');
    offline_1.install({
        onUpdating: function () {
            console.log('SW Event:', 'onUpdating');
        },
        onUpdateReady: function () {
            console.log('SW Event:', 'onUpdateReady');
            offline_1.applyUpdate();
        },
        onUpdated: function () {
            console.log('SW Event:', 'onUpdated');
        },
        onUpdateFailed: function () {
            console.log('SW Event:', 'onUpdateFailed');
        },
    });
}
else {
}
var networkInterface = createBatchingNetworkInterface({
    uri: process.env.GRAPHQL_URL ||
        (process.env.URL && process.env.URL + "/graphql") ||
        '/graphql',
    batchInterval: 5,
    opts: {
        credentials: 'same-origin',
    },
});
var client, mountNode, container, renderer, store, ua, rehydrateState, history, asyncContext;
function renderApp() {
    var app = (React.createElement(AsyncComponentProvider, { rehydrateState: rehydrateState, asyncContext: asyncContext },
        React.createElement(AppContainer, null,
            React.createElement(ApolloProvider, { store: store, client: client },
                React.createElement(FelaProvider, { renderer: renderer, mountNode: mountNode },
                    React.createElement(GatewayProvider, null,
                        React.createElement(UAProvider, { ua: ua },
                            React.createElement(AmpProvider, { amp: false },
                                React.createElement(App, null)))))))));
    asyncBootstrapper(app).then(function () { return render(app, container); });
}
function load() {
    container = document.getElementById('app');
    mountNode = document.getElementById('css-markup');
    ua = new UAParser(window.navigator.userAgent);
    renderer = createFela(ua);
    history = createHistory();
    client = new ApolloClient({
        networkInterface: networkInterface,
        dataIdFromObject: function (o) { return o.id; },
        ssrForceFetchDelay: 100,
    });
    store = createStore(combineReducers({
        apollo: client.reducer(),
        location: routerReducer(history),
        fela: felaReducer,
    }), window.INITIAL_DATA || {}, compose(applyMiddleware(client.middleware()), applyMiddleware(routerMiddleware(history))));
    attachHistory(history, store);
    rehydrateState = window.ASYNC_STATE;
    asyncContext = createAsyncContext();
    if (typeof init !== undefined && init) {
        init({ renderer: renderer, client: client, store: store });
    }
    return renderApp();
}
if (window.POLYFILLED) {
    load();
}
else {
    window.GO = load;
}
if (module.hot) {
    module.hot.accept('@app');
    module.hot.accept('@app', function () { return renderApp(require('@app').default); });
}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhY2thZ2VzL2NvcmUvd2ViL2luZGV4LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDaEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUM5QyxPQUFPLEVBQUUsWUFBWSxFQUFFLDhCQUE4QixFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzdFLE9BQU8sRUFDTCxzQkFBc0IsRUFDdEIsa0JBQWtCLEdBQ25CLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxpQkFBaUIsTUFBTSwwQkFBMEIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUNyRCxPQUFPLEVBQUUsUUFBUSxJQUFJLFlBQVksRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN0RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ2hELE9BQU8sR0FBRyxNQUFNLE1BQU0sQ0FBQztBQUN2QixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFLaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUkvRSxPQUFPLEVBQ0wsYUFBYSxFQUNiLGFBQWEsRUFDYixnQkFBZ0IsRUFDaEIsYUFBYSxHQUNkLE1BQU0sY0FBYyxDQUFDO0FBR3RCLElBQU0sSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUM7QUFFbEMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssWUFBWSxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FB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ZS93ZWIvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgcmVuZGVyIH0gZnJvbSAncmVhY3QtZG9tJztcbmltcG9ydCB7IEFtcFByb3ZpZGVyLCBVQVByb3ZpZGVyLCBVQVBhcnNlciB9IGZyb20gJ29seW1wLXV0aWxzJztcbmltcG9ydCB7IEFwb2xsb1Byb3ZpZGVyIH0gZnJvbSAncmVhY3QtYXBvbGxvJztcbmltcG9ydCB7IEFwb2xsb0NsaWVudCwgY3JlYXRlQmF0Y2hpbmdOZXR3b3JrSW50ZXJmYWNlIH0gZnJvbSAnYXBvbGxvLWNsaWVudCc7XG5pbXBvcnQge1xuICBBc3luY0NvbXBvbmVudFByb3ZpZGVyLFxuICBjcmVhdGVBc3luY0NvbnRleHQsXG59IGZyb20gJ3JlYWN0LWFzeW5jLWNvbXBvbmVudCc7XG5pbXBvcnQgYXN5bmNCb290c3RyYXBwZXIgZnJvbSAncmVhY3QtYXN5bmMtYm9vdHN0cmFwcGVyJztcbmltcG9ydCB7IGNyZWF0ZUZlbGEsIGZlbGFSZWR1Y2VyIH0gZnJvbSAnb2x5bXAtZmVsYSc7XG5pbXBvcnQgeyBQcm92aWRlciBhcyBGZWxhUHJvdmlkZXIgfSBmcm9tICdyZWFjdC1mZWxhJztcbmltcG9ydCB7IEdhdGV3YXlQcm92aWRlciB9IGZyb20gJ3JlYWN0LWdhdGV3YXknO1xuaW1wb3J0IEFwcCBmcm9tICdAYXBwJztcbmltcG9ydCB7IEFwcENvbnRhaW5lciB9IGZyb20gJ3JlYWN0LWhvdC1sb2FkZXInO1xuXG4vLyBpbXBvcnQgeyBTdWJzY3JpcHRpb25DbGllbnQsIGFkZEdyYXBoUUxTdWJzY3JpcHRpb25zIH0gZnJvbSAnc3Vic2NyaXB0aW9ucy10cmFuc3BvcnQtd3MnO1xuXG4vLyBSZWR1eCBzdHVmZlxuaW1wb3J0IHsgY3JlYXRlU3RvcmUsIGNvbWJpbmVSZWR1Y2VycywgYXBwbHlNaWRkbGV3YXJlLCBjb21wb3NlIH0gZnJvbSAncmVkdXgnO1xuLy8gRW5kIFJlZHV4IHN0dWZmXG5cbi8vIFJlYWN0IHJvdXRlclxuaW1wb3J0IHtcbiAgY3JlYXRlSGlzdG9yeSxcbiAgYXR0YWNoSGlzdG9yeSxcbiAgcm91dGVyTWlkZGxld2FyZSxcbiAgcm91dGVyUmVkdWNlcixcbn0gZnJvbSAnb2x5bXAtcm91dGVyJztcbi8vXG5cbmNvbnN0IGluaXQgPSByZXF1aXJlKCdAYXBwJykuaW5pdDtcbi8vIHdpbmRvdy5QZXJmID0gcmVxdWlyZSgncmVhY3QtYWRkb25zLXBlcmYnKTtcbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nICYmICFwcm9jZXNzLmVudi5JU19FTEVDVFJPTikge1xuICBjb25zdCBvZmZsaW5lID0gcmVxdWlyZSgnb2ZmbGluZS1wbHVnaW4vcnVudGltZScpO1xuICBvZmZsaW5lLmluc3RhbGwoe1xuICAgIG9uVXBkYXRpbmc6ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdTVyBFdmVudDonLCAnb25VcGRhdGluZycpO1xuICAgIH0sXG4gICAgb25VcGRhdGVSZWFkeTogKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1NXIEV2ZW50OicsICdvblVwZGF0ZVJlYWR5Jyk7XG4gICAgICBvZmZsaW5lLmFwcGx5VXBkYXRlKCk7XG4gICAgfSxcbiAgICBvblVwZGF0ZWQ6ICgpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdTVyBFdmVudDonLCAnb25VcGRhdGVkJyk7XG4gICAgICAvLyB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7IC8vIE9ubHkgbmVlZGVkIHdpdGggYXV0b1VwZGF0ZXNcbiAgICB9LFxuICAgIG9uVXBkYXRlRmFpbGVkOiAoKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygnU1cgRXZlbnQ6JywgJ29uVXBkYXRlRmFpbGVkJyk7XG4gICAgfSxcbiAgfSk7XG59IGVsc2Uge1xuICAvLyBjb25zdCB7IHdoeURpZFlvdVVwZGF0ZSB9ID0gcmVxdWlyZSgnd2h5LWRpZC15b3UtdXBkYXRlJyk7XG4gIC8vIHdoeURpZFlvdVVwZGF0ZShSZWFjdCk7XG59XG4vKiAvLyBUT0RPXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJykge1xuICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5nZXRSZWdpc3RyYXRpb25zKCkudGhlbigocmVnaXN0cmF0aW9ucykgPT4ge1xuICAgICAgZm9yIChjb25zdCByZWdpc3RyYXRpb24gb2YgcmVnaXN0cmF0aW9ucykge1xuICAgICAgICByZWdpc3RyYXRpb24udW5yZWdpc3RlcigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59IGVsc2Uge1xuICBjb25zb2xlLndhcm4oJ3dlYi9pbmRleC5qcyByZW1vdmVzIHNlcnZpY2V3b3JrZXJzIHRlbXBvcmFyaWx5Jyk7XG59Ki9cblxuY29uc3QgbmV0d29ya0ludGVyZmFjZSA9IGNyZWF0ZUJhdGNoaW5nTmV0d29ya0ludGVyZmFjZSh7XG4gIHVyaTpcbiAgICBwcm9jZXNzLmVudi5HUkFQSFFMX1VSTCB8fFxuICAgIChwcm9jZXNzLmVudi5VUkwgJiYgYCR7cHJvY2Vzcy5lbnYuVVJMfS9ncmFwaHFsYCkgfHxcbiAgICAnL2dyYXBocWwnLFxuICBiYXRjaEludGVydmFsOiA1LFxuICBvcHRzOiB7XG4gICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsXG4gIH0sXG59KTtcblxuLyogaWYgKHByb2Nlc3MuZW52LkdSQVBIUUxfU1VCKSB7XG4gIGNvbnN0IHdzQ2xpZW50ID0gbmV3IFN1YnNjcmlwdGlvbkNsaWVudChwcm9jZXNzLmVudi5HUkFQSFFMX1NVQiwge1xuICAgIHJlY29ubmVjdDogdHJ1ZVxuICB9KTtcbiAgbmV0d29ya0ludGVyZmFjZSA9IGFkZEdyYXBoUUxTdWJzY3JpcHRpb25zKFxuICAgIG5ldHdvcmtJbnRlcmZhY2UsXG4gICAgd3NDbGllbnRcbiAgKTtcbn0qL1xuXG5sZXQgY2xpZW50LFxuICBtb3VudE5vZGUsXG4gIGNvbnRhaW5lcixcbiAgcmVuZGVyZXIsXG4gIHN0b3JlLFxuICB1YSxcbiAgcmVoeWRyYXRlU3RhdGUsXG4gIGhpc3RvcnksXG4gIGFzeW5jQ29udGV4dDtcbmZ1bmN0aW9uIHJlbmRlckFwcCgpIHtcbiAgY29uc3QgYXBwID0gKFxuICAgIDxBc3luY0NvbXBvbmVudFByb3ZpZGVyXG4gICAgICByZWh5ZHJhdGVTdGF0ZT17cmVoeWRyYXRlU3RhdGV9XG4gICAgICBhc3luY0NvbnRleHQ9e2FzeW5jQ29udGV4dH1cbiAgICA+XG4gICAgICA8QXBwQ29udGFpbmVyPlxuICAgICAgICA8QXBvbGxvUHJvdmlkZXIgc3RvcmU9e3N0b3JlfSBjbGllbnQ9e2NsaWVudH0+XG4gICAgICAgICAgPEZlbGFQcm92aWRlciByZW5kZXJlcj17cmVuZGVyZXJ9IG1vdW50Tm9kZT17bW91bnROb2RlfT5cbiAgICAgICAgICAgIDxHYXRld2F5UHJvdmlkZXI+XG4gICAgICAgICAgICAgIDxVQVByb3ZpZGVyIHVhPXt1YX0+XG4gICAgICAgICAgICAgICAgPEFtcFByb3ZpZGVyIGFtcD17ZmFsc2V9PlxuICAgICAgICAgICAgICAgICAgPEFwcCAvPlxuICAgICAgICAgICAgICAgIDwvQW1wUHJvdmlkZXI+XG4gICAgICAgICAgICAgIDwvVUFQcm92aWRlcj5cbiAgICAgICAgICAgIDwvR2F0ZXdheVByb3ZpZGVyPlxuICAgICAgICAgIDwvRmVsYVByb3ZpZGVyPlxuICAgICAgICA8L0Fwb2xsb1Byb3ZpZGVyPlxuICAgICAgPC9BcHBDb250YWluZXI+XG4gICAgPC9Bc3luY0NvbXBvbmVudFByb3ZpZGVyPlxuICApO1xuICBhc3luY0Jvb3RzdHJhcHBlcihhcHApLnRoZW4oKCkgPT4gcmVuZGVyKGFwcCwgY29udGFpbmVyKSk7XG59XG5mdW5jdGlvbiBsb2FkKCkge1xuICAvLyBHZXQgdGhlIERPTSBFbGVtZW50IHRoYXQgd2lsbCBob3N0IG91ciBSZWFjdCBhcHBsaWNhdGlvbi5cbiAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FwcCcpO1xuICBtb3VudE5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3NzLW1hcmt1cCcpO1xuICB1YSA9IG5ldyBVQVBhcnNlcih3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XG4gIHJlbmRlcmVyID0gY3JlYXRlRmVsYSh1YSk7XG4gIGhpc3RvcnkgPSBjcmVhdGVIaXN0b3J5KCk7XG4gIGNsaWVudCA9IG5ldyBBcG9sbG9DbGllbnQoe1xuICAgIG5ldHdvcmtJbnRlcmZhY2UsXG4gICAgZGF0YUlkRnJvbU9iamVjdDogbyA9PiBvLmlkLFxuICAgIHNzckZvcmNlRmV0Y2hEZWxheTogMTAwLFxuICAgIC8vIGluaXRpYWxTdGF0ZTogd2luZG93LklOSVRJQUxfREFUQSxcbiAgfSk7XG4gIC8vIFJlZHV4IHN0dWZmXG4gIC8vIGNvbnN0IGNvbXBvc2VFbmhhbmNlcnMgPSB3aW5kb3cuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fQ09NUE9TRV9fIHx8IGNvbXBvc2U7XG4gIHN0b3JlID0gY3JlYXRlU3RvcmUoXG4gICAgY29tYmluZVJlZHVjZXJzKHtcbiAgICAgIGFwb2xsbzogY2xpZW50LnJlZHVjZXIoKSxcbiAgICAgIGxvY2F0aW9uOiByb3V0ZXJSZWR1Y2VyKGhpc3RvcnkpLFxuICAgICAgZmVsYTogZmVsYVJlZHVjZXIsXG4gICAgfSksXG4gICAgd2luZG93LklOSVRJQUxfREFUQSB8fCB7fSxcbiAgICBjb21wb3NlKFxuICAgICAgYXBwbHlNaWRkbGV3YXJlKGNsaWVudC5taWRkbGV3YXJlKCkpLFxuICAgICAgYXBwbHlNaWRkbGV3YXJlKHJvdXRlck1pZGRsZXdhcmUoaGlzdG9yeSkpXG4gICAgKVxuICApO1xuICBhdHRhY2hIaXN0b3J5KGhpc3RvcnksIHN0b3JlKTtcbiAgLy8gRW5kIFJlZHV4IHN0dWZmXG4gIHJlaHlkcmF0ZVN0YXRlID0gd2luZG93LkFTWU5DX1NUQVRFO1xuICBhc3luY0NvbnRleHQgPSBjcmVhdGVBc3luY0NvbnRleHQoKTtcblxuICBpZiAodHlwZW9mIGluaXQgIT09IHVuZGVmaW5lZCAmJiBpbml0KSB7XG4gICAgaW5pdCh7IHJlbmRlcmVyLCBjbGllbnQsIHN0b3JlIH0pO1xuICB9XG5cbiAgcmV0dXJuIHJlbmRlckFwcCgpO1xufVxuXG4vLyBFeGVjdXRlIHRoZSBmaXJzdCByZW5kZXIgb2Ygb3VyIGFwcC5cbmlmICh3aW5kb3cuUE9MWUZJTExFRCkge1xuICBsb2FkKCk7XG59IGVsc2Uge1xuICB3aW5kb3cuR08gPSBsb2FkO1xufVxuXG5pZiAobW9kdWxlLmhvdCkge1xuICAvLyBBY2NlcHQgY2hhbmdlcyB0byB0aGlzIGZpbGUgZm9yIGhvdCByZWxvYWRpbmcuXG4gIG1vZHVsZS5ob3QuYWNjZXB0KCdAYXBwJyk7XG4gIC8vIEFueSBjaGFuZ2VzIHRvIG91ciBBcHAgd2lsbCBjYXVzZSBhIGhvdGxvYWQgcmUtcmVuZGVyLlxuICBtb2R1bGUuaG90LmFjY2VwdCgnQGFwcCcsICgpID0+IHJlbmRlckFwcChyZXF1aXJlKCdAYXBwJykuZGVmYXVsdCkpO1xufVxuIl19
